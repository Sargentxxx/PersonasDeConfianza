[{"filePath":"C:\\Users\\Usuario\\OneDrive\\Desktop\\Antigravity\\Personas de Confianza\\personas-de-confianza\\app\\admin\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":515,"column":27,"nodeType":"JSXOpeningElement","endLine":522,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":606,"column":37,"nodeType":"JSXOpeningElement","endLine":610,"endColumn":39,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":908,"column":33,"nodeType":"JSXOpeningElement","endLine":915,"endColumn":35,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Usuario\\OneDrive\\Desktop\\Antigravity\\Personas de Confianza\\personas-de-confianza\\app\\api\\mercadopago\\create-preference\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Usuario\\OneDrive\\Desktop\\Antigravity\\Personas de Confianza\\personas-de-confianza\\app\\api\\mercadopago\\webhook\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2182,2185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2182,2185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from \"next/server\";\r\nexport const dynamic = \"force-dynamic\";\r\nimport { MercadoPagoConfig, Payment } from \"mercadopago\";\r\nimport { db } from \"@/lib/firebase\";\r\nimport { doc, updateDoc, serverTimestamp, getDoc } from \"firebase/firestore\";\r\n\r\n// Configuraci??n del cliente de Mercado Pago\r\nexport async function POST(request: NextRequest) {\r\n    const client = new MercadoPagoConfig({\r\n        accessToken: process.env.MERCADOPAGO_ACCESS_TOKEN || \"\",\r\n    });\r\n\r\n    try {\r\n        const body = await request.json();\r\n\r\n        console.log(\"Webhook received from Mercado Pago:\", body);\r\n\r\n        // Mercado Pago env??a notificaciones de diferentes tipos\r\n        // Nos interesan las de tipo \"payment\"\r\n        if (body.type === \"payment\") {\r\n            const paymentId = body.data?.id;\r\n\r\n            if (!paymentId) {\r\n                return NextResponse.json({ error: \"No payment ID\" }, { status: 400 });\r\n            }\r\n\r\n            // Obtener detalles del pago desde Mercado Pago\r\n            const payment = new Payment(client);\r\n            const paymentData = await payment.get({ id: paymentId });\r\n\r\n            console.log(\"Payment data:\", paymentData);\r\n\r\n            // Obtener la referencia externa (ID de la solicitud)\r\n            const requestId = paymentData.external_reference;\r\n\r\n            if (!requestId) {\r\n                console.error(\"No external reference found in payment\");\r\n                return NextResponse.json(\r\n                    { error: \"No external reference\" },\r\n                    { status: 400 }\r\n                );\r\n            }\r\n\r\n            // Actualizar el estado en Firebase seg??n el status del pago\r\n            const requestRef = doc(db, \"requests\", requestId);\r\n\r\n            // Verificar que el documento existe\r\n            const requestDoc = await getDoc(requestRef);\r\n            if (!requestDoc.exists()) {\r\n                console.error(\"Request not found:\", requestId);\r\n                return NextResponse.json(\r\n                    { error: \"Request not found\" },\r\n                    { status: 404 }\r\n                );\r\n            }\r\n\r\n            const updateData: Record<string, any> = {\r\n                paymentId: paymentId,\r\n                paymentStatus: paymentData.status,\r\n                paymentStatusDetail: paymentData.status_detail,\r\n                paymentMethod: paymentData.payment_method_id,\r\n                paymentAmount: paymentData.transaction_amount,\r\n                paymentUpdatedAt: serverTimestamp(),\r\n            };\r\n\r\n            // Mapear estados de Mercado Pago a estados de nuestra app\r\n            switch (paymentData.status) {\r\n                case \"approved\":\r\n                    updateData.status = \"paid\"; // Pagado, en ejecuci??n\r\n                    updateData.paidAt = serverTimestamp();\r\n                    break;\r\n                case \"pending\":\r\n                case \"in_process\":\r\n                    updateData.status = \"payment_pending\"; // Pago pendiente\r\n                    break;\r\n                case \"rejected\":\r\n                case \"cancelled\":\r\n                    updateData.status = \"payment_failed\"; // Pago rechazado\r\n                    break;\r\n                default:\r\n                    console.log(\"Unhandled payment status:\", paymentData.status);\r\n            }\r\n\r\n            await updateDoc(requestRef, updateData);\r\n\r\n            console.log(\"Request updated successfully:\", requestId);\r\n\r\n            return NextResponse.json({ success: true });\r\n        }\r\n\r\n        // Si no es un webhook de pago, simplemente responder OK\r\n        return NextResponse.json({ received: true });\r\n    } catch (error: unknown) {\r\n        const err = error as Error;\r\n        console.error(\"Error processing webhook:\", err);\r\n        return NextResponse.json(\r\n            {\r\n                error: \"Error processing webhook\",\r\n                details: err.message,\r\n            },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n\r\n// Mercado Pago puede enviar webhooks v??a GET tambi??n (para validaci??n)\r\nexport async function GET() {\r\n    return NextResponse.json({ status: \"Webhook endpoint ready\" });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Usuario\\OneDrive\\Desktop\\Antigravity\\Personas de Confianza\\personas-de-confianza\\app\\auth\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2639,2642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2639,2642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3535,3538],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3535,3538],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":164,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5226,5229],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5226,5229],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":508,"column":19,"nodeType":"JSXOpeningElement","endLine":512,"endColumn":21}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, Suspense } from \"react\";\r\nimport Image from \"next/image\";\r\nimport Link from \"next/link\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\nimport { auth, db } from \"@/lib/firebase\";\r\nimport {\r\n  signInWithEmailAndPassword,\r\n  createUserWithEmailAndPassword,\r\n  updateProfile,\r\n  signInWithPopup,\r\n  GoogleAuthProvider,\r\n  AuthError,\r\n} from \"firebase/auth\";\r\nimport { doc, setDoc, getDoc } from \"firebase/firestore\";\r\n\r\nfunction AuthContent() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  const initialMode =\r\n    searchParams.get(\"mode\") === \"signup\" ? \"register\" : \"login\";\r\n  const initialRole = searchParams.get(\"role\") === \"rep\" ? \"rep\" : \"client\";\r\n\r\n  const [activeTab, setActiveTab] = useState<\"login\" | \"register\">(initialMode);\r\n  const [role, setRole] = useState<\"client\" | \"rep\">(initialRole);\r\n\r\n  useEffect(() => {\r\n    // Update state if URL params change (e.g. going back/forward)\r\n    const mode = searchParams.get(\"mode\") === \"signup\" ? \"register\" : \"login\";\r\n    setActiveTab(mode);\r\n    const roleParam = searchParams.get(\"role\") === \"rep\" ? \"rep\" : \"client\";\r\n    setRole(roleParam);\r\n  }, [searchParams]);\r\n\r\n  // Form State\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [name, setName] = useState(\"\");\r\n  const [phone, setPhone] = useState(\"\");\r\n\r\n  // UI State\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const handleLogin = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setIsLoading(true);\r\n    setError(null);\r\n    try {\r\n      const userCredential = await signInWithEmailAndPassword(\r\n        auth,\r\n        email,\r\n        password,\r\n      );\r\n\r\n      // Fetch user role from Firestore to redirect correctly\r\n      const userDoc = await getDoc(doc(db, \"users\", userCredential.user.uid));\r\n\r\n      // CRITICAL: Use Firestore role, NOT the UI state 'role'\r\n      let dbRole: string = \"client\"; // Safe default fallback\r\n\r\n      if (userDoc.exists()) {\r\n        dbRole = userDoc.data().role;\r\n      } else {\r\n        console.warn(\r\n          \"Usuario sin documento en Firestore, usando rol por defecto: client\",\r\n        );\r\n      }\r\n\r\n      console.log(\"Login exitoso. Rol en BD:\", dbRole);\r\n\r\n      // Redirection logic based on real DB role\r\n      if (dbRole === \"admin\") {\r\n        router.push(\"/admin\");\r\n      } else if (dbRole === \"rep\") {\r\n        router.push(\"/dashboard/rep\");\r\n      } else {\r\n        router.push(\"/dashboard/client\");\r\n      }\r\n    } catch (err: any) {\r\n      console.error(err);\r\n      setError(getErrorMessage(err));\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleRegister = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setIsLoading(true);\r\n    setError(null);\r\n    try {\r\n      const userCredential = await createUserWithEmailAndPassword(\r\n        auth,\r\n        email,\r\n        password,\r\n      );\r\n      await updateProfile(userCredential.user, { displayName: name });\r\n\r\n      // Save extra user info to Firestore\r\n      await setDoc(doc(db, \"users\", userCredential.user.uid), {\r\n        uid: userCredential.user.uid,\r\n        name: name,\r\n        email: email,\r\n        phone: phone,\r\n        role: role,\r\n        createdAt: new Date().toISOString(),\r\n      });\r\n\r\n      if (role === \"client\") router.push(\"/dashboard/client\");\r\n      else router.push(\"/dashboard/rep\");\r\n    } catch (err: any) {\r\n      console.error(err);\r\n      setError(getErrorMessage(err));\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleGoogleLogin = async () => {\r\n    setIsLoading(true);\r\n    setError(null);\r\n    try {\r\n      const provider = new GoogleAuthProvider();\r\n      // Forzar que Google pida cuenta si hay varias\r\n      provider.setCustomParameters({ prompt: \"select_account\" });\r\n\r\n      const result = await signInWithPopup(auth, provider);\r\n\r\n      // Check if user exists in Firestore\r\n      const userDocRef = doc(db, \"users\", result.user.uid);\r\n      const userDoc = await getDoc(userDocRef);\r\n\r\n      let dbRole: string;\r\n\r\n      if (!userDoc.exists()) {\r\n        console.log(\"Creando nuevo usuario con Google:\", role);\r\n        // Create new user doc - HERE we DO use the UI 'role' because it's a new account\r\n        await setDoc(userDocRef, {\r\n          uid: result.user.uid,\r\n          name: result.user.displayName || \"Usuario Google\",\r\n          email: result.user.email,\r\n          phone: result.user.phoneNumber || \"\",\r\n          role: role,\r\n          createdAt: new Date().toISOString(),\r\n        });\r\n        dbRole = role; // New user: use selected role from UI\r\n      } else {\r\n        // Existing user: ALWAYS use Firestore role, ignore UI selection\r\n        dbRole = userDoc.data().role;\r\n      }\r\n\r\n      console.log(\"Login Google exitoso. Rol en BD:\", dbRole);\r\n\r\n      // Redirection logic based on real DB role\r\n      if (dbRole === \"admin\") {\r\n        router.push(\"/admin\");\r\n      } else if (dbRole === \"rep\") {\r\n        router.push(\"/dashboard/rep\");\r\n      } else {\r\n        router.push(\"/dashboard/client\");\r\n      }\r\n    } catch (err: any) {\r\n      console.error(\"Error completo de Google Login:\", err);\r\n      if (err.code === \"auth/popup-closed-by-user\") {\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n      if (err.code === \"auth/unauthorized-domain\") {\r\n        const domain =\r\n          typeof window !== \"undefined\"\r\n            ? window.location.hostname\r\n            : \"este dominio\";\r\n        console.error(\r\n          `ERROR T??CNICO: El dominio ${domain} no est?? autorizado en Firebase Console.`,\r\n        );\r\n        setError(\r\n          \"Lo sentimos, el servicio de autenticaci??n no est?? disponible temporalmente en este dominio. Por favor, intenta desde el dominio principal o contacta con el administrador.\",\r\n        );\r\n      } else {\r\n        setError(getErrorMessage(err));\r\n      }\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const getErrorMessage = (error: AuthError) => {\r\n    switch (error.code) {\r\n      case \"auth/invalid-email\":\r\n        return \"El correo electr??nico no es v??lido.\";\r\n      case \"auth/user-disabled\":\r\n        return \"Este usuario ha sido deshabilitado.\";\r\n      case \"auth/user-not-found\":\r\n        return \"No existe una cuenta con este correo.\";\r\n      case \"auth/wrong-password\":\r\n        return \"La contrase??a es incorrecta.\";\r\n      case \"auth/email-already-in-use\":\r\n        return \"El correo electr??nico ya est?? registrado.\";\r\n      case \"auth/weak-password\":\r\n        return \"La contrase??a es muy d??bil (m??nimo 6 caracteres).\";\r\n      default:\r\n        return \"Ocurri?? un error inesperado. Int??ntalo de nuevo: \" + error.code;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-background min-h-screen flex items-center justify-center p-0 overflow-hidden font-sans text-foreground\">\r\n      <div className=\"w-full h-screen flex relative\">\r\n        {/* Left Side (Visual/Brand) */}\r\n        <div className=\"hidden lg:flex lg:w-1/2 relative flex-col justify-between p-12 text-white overflow-hidden\">\r\n          {/* Background Image & Effects */}\r\n          <div className=\"absolute inset-0 z-0\">\r\n            <Image\r\n              src=\"https://images.unsplash.com/photo-1521737604893-d14cc237f11d?ixlib=rb-4.0.3&auto=format&fit=crop&w=2084&q=80\"\r\n              alt=\"Trust Background\"\r\n              fill\r\n              className=\"object-cover\"\r\n            />\r\n            <div className=\"absolute inset-0 bg-primary/80 mix-blend-multiply\"></div>\r\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 to-transparent\"></div>\r\n          </div>\r\n\r\n          {/* Content */}\r\n          <div className=\"relative z-10\">\r\n            <Link\r\n              href=\"/\"\r\n              className=\"flex items-center gap-3 mb-12 hover:opacity-90 transition-opacity\"\r\n            >\r\n              <div className=\"w-10 h-10 bg-white/20 backdrop-blur-md rounded-lg flex items-center justify-center text-white border border-white/30\">\r\n                <span className=\"material-symbols-outlined text-2xl\">\r\n                  verified_user\r\n                </span>\r\n              </div>\r\n              <span className=\"text-2xl font-heading font-bold tracking-tight\">\r\n                Personas de Confianza\r\n              </span>\r\n            </Link>\r\n          </div>\r\n\r\n          <div className=\"relative z-10 max-w-lg\">\r\n            <h2 className=\"text-4xl lg:text-5xl font-heading font-bold leading-tight mb-6\">\r\n              Construimos relaciones basadas en la{\" \"}\r\n              <span className=\"text-cta\">confianza</span>.\r\n            </h2>\r\n            <p className=\"text-lg text-white/90 leading-relaxed mb-8\">\r\n              ??nete a la comunidad l??der en verificaci??n de identidad y\r\n              reputaci??n. Seguridad para tus transacciones, tranquilidad para tu\r\n              vida.\r\n            </p>\r\n\r\n            {/* Simple Trust Stats */}\r\n            <div className=\"grid grid-cols-2 gap-6 pt-8 border-t border-white/20\">\r\n              <div>\r\n                <div className=\"text-3xl font-bold mb-1\">10k+</div>\r\n                <div className=\"text-sm text-white/70\">\r\n                  Usuarios Verificados\r\n                </div>\r\n              </div>\r\n              <div>\r\n                <div className=\"text-3xl font-bold mb-1\">98%</div>\r\n                <div className=\"text-sm text-white/70\">Satisfacci??n</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Right Side (Form Area) */}\r\n        <div className=\"w-full lg:w-1/2 flex flex-col items-center justify-center p-6 lg:p-12 bg-white relative\">\r\n          <div className=\"max-w-md w-full\">\r\n            {/* Header */}\r\n            <div className=\"text-center mb-8\">\r\n              <h2 className=\"text-3xl font-heading font-bold text-foreground mb-2\">\r\n                {activeTab === \"login\"\r\n                  ? \"Bienvenido de nuevo\"\r\n                  : \"Crea tu cuenta\"}\r\n              </h2>\r\n              <p className=\"text-slate-500\">\r\n                {activeTab === \"login\"\r\n                  ? \"Ingresa tus credenciales para acceder\"\r\n                  : \"Comienza hoy mismo, es r??pido y seguro\"}\r\n              </p>\r\n            </div>\r\n\r\n            {/* Tabs */}\r\n            <div className=\"flex p-1 bg-slate-100 rounded-xl mb-8\">\r\n              <button\r\n                onClick={() => setActiveTab(\"login\")}\r\n                className={`flex-1 py-2.5 text-sm font-semibold rounded-lg transition-all ${\r\n                  activeTab === \"login\"\r\n                    ? \"bg-white text-primary shadow-sm\"\r\n                    : \"text-slate-500 hover:text-slate-700\"\r\n                }`}\r\n              >\r\n                Iniciar Sesi??n\r\n              </button>\r\n              <button\r\n                onClick={() => setActiveTab(\"register\")}\r\n                className={`flex-1 py-2.5 text-sm font-semibold rounded-lg transition-all ${\r\n                  activeTab === \"register\"\r\n                    ? \"bg-white text-primary shadow-sm\"\r\n                    : \"text-slate-500 hover:text-slate-700\"\r\n                }`}\r\n              >\r\n                Registrarse\r\n              </button>\r\n            </div>\r\n\r\n            {/* Role Selection (Only for Register) */}\r\n            {activeTab === \"register\" && (\r\n              <div className=\"flex gap-4 mb-6\">\r\n                <label\r\n                  className={`flex-1 cursor-pointer border-2 rounded-xl p-4 transition-all ${role === \"client\" ? \"border-primary bg-primary/5\" : \"border-slate-100 hover:border-slate-200\"}`}\r\n                >\r\n                  <input\r\n                    type=\"radio\"\r\n                    name=\"role\"\r\n                    value=\"client\"\r\n                    checked={role === \"client\"}\r\n                    onChange={() => setRole(\"client\")}\r\n                    className=\"sr-only\"\r\n                  />\r\n                  <div className=\"flex flex-col items-center text-center\">\r\n                    <span\r\n                      className={`material-symbols-outlined mb-2 ${role === \"client\" ? \"text-primary\" : \"text-slate-400\"}`}\r\n                    >\r\n                      person\r\n                    </span>\r\n                    <span\r\n                      className={`font-semibold text-sm ${role === \"client\" ? \"text-primary\" : \"text-slate-600\"}`}\r\n                    >\r\n                      Cliente\r\n                    </span>\r\n                  </div>\r\n                </label>\r\n                <label\r\n                  className={`flex-1 cursor-pointer border-2 rounded-xl p-4 transition-all ${role === \"rep\" ? \"border-primary bg-primary/5\" : \"border-slate-100 hover:border-slate-200\"}`}\r\n                >\r\n                  <input\r\n                    type=\"radio\"\r\n                    name=\"role\"\r\n                    value=\"rep\"\r\n                    checked={role === \"rep\"}\r\n                    onChange={() => setRole(\"rep\")}\r\n                    className=\"sr-only\"\r\n                  />\r\n                  <div className=\"flex flex-col items-center text-center\">\r\n                    <span\r\n                      className={`material-symbols-outlined mb-2 ${role === \"rep\" ? \"text-primary\" : \"text-slate-400\"}`}\r\n                    >\r\n                      badge\r\n                    </span>\r\n                    <span\r\n                      className={`font-semibold text-sm ${role === \"rep\" ? \"text-primary\" : \"text-slate-600\"}`}\r\n                    >\r\n                      Representante\r\n                    </span>\r\n                  </div>\r\n                </label>\r\n              </div>\r\n            )}\r\n\r\n            {/* Error Message */}\r\n            {error && (\r\n              <div className=\"mb-6 p-4 bg-red-50 border border-red-100 text-red-600 rounded-lg text-sm flex items-start gap-2 animate-fade-in-up\">\r\n                <span className=\"material-symbols-outlined text-lg mt-0.5\">\r\n                  error\r\n                </span>\r\n                <span>{error}</span>\r\n              </div>\r\n            )}\r\n\r\n            {/* Form */}\r\n            <form\r\n              onSubmit={activeTab === \"login\" ? handleLogin : handleRegister}\r\n              className=\"flex flex-col gap-4\"\r\n            >\r\n              {activeTab === \"register\" && (\r\n                <div className=\"flex flex-col gap-1.5\">\r\n                  <label className=\"text-sm font-semibold text-slate-700\">\r\n                    Nombre completo\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    required\r\n                    placeholder=\"Ej. Juan P??rez\"\r\n                    value={name}\r\n                    onChange={(e) => setName(e.target.value)}\r\n                    className=\"input\"\r\n                  />\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"flex flex-col gap-1.5\">\r\n                <label className=\"text-sm font-semibold text-slate-700\">\r\n                  Correo electr??nico\r\n                </label>\r\n                <input\r\n                  type=\"email\"\r\n                  required\r\n                  placeholder=\"nombre@ejemplo.com\"\r\n                  value={email}\r\n                  onChange={(e) => setEmail(e.target.value)}\r\n                  className=\"input\"\r\n                />\r\n              </div>\r\n\r\n              {activeTab === \"register\" && (\r\n                <div className=\"flex flex-col gap-1.5\">\r\n                  <label className=\"text-sm font-semibold text-slate-700\">\r\n                    Tel??fono\r\n                  </label>\r\n                  <input\r\n                    type=\"tel\"\r\n                    placeholder=\"+34 600 000 000\"\r\n                    value={phone}\r\n                    onChange={(e) => setPhone(e.target.value)}\r\n                    className=\"input\"\r\n                  />\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"flex flex-col gap-1.5\">\r\n                <label className=\"text-sm font-semibold text-slate-700\">\r\n                  Contrase??a\r\n                </label>\r\n                <input\r\n                  type=\"password\"\r\n                  required\r\n                  placeholder=\"????????????????????????\"\r\n                  value={password}\r\n                  onChange={(e) => setPassword(e.target.value)}\r\n                  className=\"input\"\r\n                />\r\n                {activeTab === \"login\" && (\r\n                  <div className=\"text-right mt-1\">\r\n                    <a\r\n                      href=\"#\"\r\n                      className=\"text-xs font-semibold text-primary hover:text-primary/80\"\r\n                    >\r\n                      ??Olvidaste tu contrase??a?\r\n                    </a>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isLoading}\r\n                className=\"btn-primary w-full mt-4 flex items-center justify-center gap-2\"\r\n              >\r\n                {isLoading && (\r\n                  <span className=\"material-symbols-outlined animate-spin text-lg\">\r\n                    progress_activity\r\n                  </span>\r\n                )}\r\n                {activeTab === \"login\" ? \"Iniciar Sesi??n\" : \"Crear Cuenta\"}\r\n              </button>\r\n            </form>\r\n\r\n            {/* Social Login */}\r\n            <div className=\"mt-8\">\r\n              <div className=\"relative mb-6\">\r\n                <div className=\"absolute inset-0 flex items-center\">\r\n                  <div className=\"w-full border-t border-slate-100\"></div>\r\n                </div>\r\n                <div className=\"relative flex justify-center text-xs uppercase\">\r\n                  <span className=\"bg-white px-2 text-slate-400\">\r\n                    O contin??a con\r\n                  </span>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={handleGoogleLogin}\r\n                  disabled={isLoading}\r\n                  className=\"flex items-center justify-center gap-2 py-2.5 border border-slate-200 rounded-xl hover:bg-slate-50 transition-colors\"\r\n                >\r\n                  <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\r\n                    <path\r\n                      d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"\r\n                      fill=\"#4285F4\"\r\n                    />\r\n                    <path\r\n                      d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"\r\n                      fill=\"#34A853\"\r\n                    />\r\n                    <path\r\n                      d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"\r\n                      fill=\"#FBBC05\"\r\n                    />\r\n                    <path\r\n                      d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"\r\n                      fill=\"#EA4335\"\r\n                    />\r\n                  </svg>\r\n                  <span className=\"text-sm font-semibold text-slate-600\">\r\n                    Google\r\n                  </span>\r\n                </button>\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"flex items-center justify-center gap-2 py-2.5 border border-slate-200 rounded-xl hover:bg-slate-50 transition-colors\"\r\n                >\r\n                  <img\r\n                    src=\"https://upload.wikimedia.org/wikipedia/commons/c/ca/LinkedIn_logo_initials.png\"\r\n                    alt=\"LinkedIn\"\r\n                    className=\"w-5 h-5\"\r\n                  />\r\n                  <span className=\"text-sm font-semibold text-slate-600\">\r\n                    LinkedIn\r\n                  </span>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function AuthPage() {\r\n  return (\r\n    <Suspense\r\n      fallback={\r\n        <div className=\"min-h-screen flex items-center justify-center bg-background\">\r\n          <div className=\"w-16 h-16 border-4 border-primary/30 border-t-primary rounded-full animate-spin\"></div>\r\n        </div>\r\n      }\r\n    >\r\n      <AuthContent />\r\n    </Suspense>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Usuario\\OneDrive\\Desktop\\Antigravity\\Personas de Confianza\\personas-de-confianza\\app\\dashboard\\chat\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":225,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6872,6875],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6872,6875],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":407,"column":21,"nodeType":"JSXOpeningElement","endLine":411,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect, useRef, Suspense } from \"react\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\nimport { useAuth } from \"@/components/AuthProvider\";\r\nimport { db, storage } from \"@/lib/firebase\";\r\nimport {\r\n  doc,\r\n  getDoc,\r\n  collection,\r\n  addDoc,\r\n  query,\r\n  orderBy,\r\n  onSnapshot,\r\n  serverTimestamp,\r\n  Timestamp,\r\n} from \"firebase/firestore\";\r\nimport { ref, uploadBytes, getDownloadURL } from \"firebase/storage\";\r\nimport { sendNotification } from \"@/lib/notifications\";\r\n\r\ninterface Message {\r\n  id: string;\r\n  text?: string;\r\n  imageUrl?: string;\r\n  audioUrl?: string;\r\n  videoUrl?: string;\r\n  documentUrl?: string;\r\n  fileName?: string;\r\n  fileType?: string;\r\n  senderId: string;\r\n  createdAt: Timestamp;\r\n}\r\n\r\ninterface RequestData {\r\n  title: string;\r\n  clientId: string;\r\n  repId: string;\r\n  clientName: string;\r\n  repName: string;\r\n}\r\n\r\nfunction ChatContent() {\r\n  const searchParams = useSearchParams();\r\n  const taskId = searchParams.get(\"id\"); // Get ID from query param ?id=...\r\n  const { user, userData, loading: authLoading } = useAuth();\r\n  const router = useRouter();\r\n  const scrollRef = useRef<HTMLDivElement>(null);\r\n\r\n  const [taskData, setTaskData] = useState<RequestData | null>(null);\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [newMessage, setNewMessage] = useState(\"\");\r\n  const [loading, setLoading] = useState(true);\r\n  const [accessDenied, setAccessDenied] = useState(false);\r\n  const [uploading, setUploading] = useState(false);\r\n\r\n  // Audio Recording State\r\n  const [isRecording, setIsRecording] = useState(false);\r\n  const [mediaRecorder, setMediaRecorder] = useState<MediaRecorder | null>(\r\n    null,\r\n  );\r\n  const [audioChunks, setAudioChunks] = useState<Blob[]>([]);\r\n  const [audioBlob, setAudioBlob] = useState<Blob | null>(null);\r\n  const [recordingTime, setRecordingTime] = useState(0);\r\n  const recordingTimerRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const videoInputRef = useRef<HTMLInputElement>(null);\r\n  const docInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const dashboardPath =\r\n    userData?.role === \"rep\" ? \"/dashboard/rep\" : \"/dashboard/client\";\r\n\r\n  // 1. Load Task Details to verify access & show title\r\n  useEffect(() => {\r\n    if (!user || !taskId) return;\r\n\r\n    const fetchTask = async () => {\r\n      try {\r\n        const docRef = doc(db, \"requests\", taskId);\r\n        const docSnap = await getDoc(docRef);\r\n\r\n        if (docSnap.exists()) {\r\n          const data = docSnap.data() as RequestData;\r\n\r\n          // Verificaci??n de seguridad mejorada\r\n          const isClient = user.uid === data.clientId;\r\n          const isRep = user.uid === data.repId;\r\n\r\n          if (!isClient && !isRep) {\r\n            console.warn(\r\n              \"Acceso denegado: El usuario no es ni el cliente ni el rep de esta tarea.\",\r\n            );\r\n            setAccessDenied(true);\r\n            return;\r\n          }\r\n          setTaskData(data);\r\n        } else {\r\n          console.error(\"La tarea no existe en base de datos:\", taskId);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Error al cargar la tarea:\", err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchTask();\r\n  }, [taskId, user, router]);\r\n\r\n  // 2. Load Messages in Real-Time\r\n  useEffect(() => {\r\n    if (!taskId) return;\r\n\r\n    const q = query(\r\n      collection(db, \"requests\", taskId, \"messages\"),\r\n      orderBy(\"createdAt\", \"asc\"),\r\n    );\r\n\r\n    const unsubscribe = onSnapshot(q, (snapshot) => {\r\n      const msgs = snapshot.docs.map((doc) => ({\r\n        id: doc.id,\r\n        ...doc.data(),\r\n      })) as Message[];\r\n      // Ensure messages are sorted by createdAt, handling potential nulls\r\n      const sortedMsgs = msgs.sort((a, b) => {\r\n        const aTime = a.createdAt?.toMillis() || 0;\r\n        const bTime = b.createdAt?.toMillis() || 0;\r\n        return aTime - bTime;\r\n      });\r\n      setMessages(sortedMsgs);\r\n      setLoading(false);\r\n      // Auto-scroll to bottom\r\n      setTimeout(() => {\r\n        scrollRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n      }, 100);\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, [taskId]);\r\n\r\n  // Effect to construct blob when recording stops\r\n  useEffect(() => {\r\n    if (!isRecording && audioChunks.length > 0) {\r\n      const blob = new Blob(audioChunks, { type: \"audio/webm\" });\r\n      setAudioBlob(blob);\r\n    }\r\n  }, [isRecording, audioChunks]);\r\n\r\n  const handleSendMessage = async (e?: React.FormEvent) => {\r\n    if (e) e.preventDefault();\r\n    if ((!newMessage.trim() && !audioBlob) || !user || !taskId) return;\r\n\r\n    try {\r\n      if (audioBlob) {\r\n        // Upload Audio\r\n        setUploading(true);\r\n        const storageRef = ref(\r\n          storage,\r\n          `chat_audio/${taskId}/${Date.now()}.webm`,\r\n        );\r\n        await uploadBytes(storageRef, audioBlob);\r\n        const url = await getDownloadURL(storageRef);\r\n\r\n        await addDoc(collection(db, \"requests\", taskId, \"messages\"), {\r\n          audioUrl: url,\r\n          senderId: user.uid,\r\n          createdAt: serverTimestamp(),\r\n          fileType: \"audio/webm\",\r\n        });\r\n        setAudioBlob(null);\r\n        setAudioChunks([]);\r\n      } else {\r\n        // Text Message\r\n        await addDoc(collection(db, \"requests\", taskId, \"messages\"), {\r\n          text: newMessage,\r\n          senderId: user.uid,\r\n          createdAt: serverTimestamp(),\r\n        });\r\n      }\r\n\r\n      // Trigger Notification\r\n      const recipientId =\r\n        user.uid === taskData?.clientId ? taskData?.repId : taskData?.clientId;\r\n      if (recipientId) {\r\n        sendNotification({\r\n          recipientId,\r\n          title: audioBlob ? \"Nuevo audio\" : \"Nuevo mensaje\",\r\n          message: audioBlob\r\n            ? \"Te ha enviado un mensaje de voz.\"\r\n            : `${user.displayName}: ${newMessage}`,\r\n          type: \"chat\",\r\n          link: `/dashboard/chat?id=${taskId}`,\r\n        });\r\n      }\r\n\r\n      setNewMessage(\"\");\r\n    } catch (error) {\r\n      console.error(\"Error sending message:\", error);\r\n      alert(\"Error al enviar mensaje.\");\r\n    } finally {\r\n      setUploading(false);\r\n    }\r\n  };\r\n\r\n  const handleFileUpload = async (\r\n    e: React.ChangeEvent<HTMLInputElement>,\r\n    type: \"image\" | \"video\" | \"document\",\r\n  ) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file || !user || !taskId) return;\r\n\r\n    setUploading(true);\r\n    try {\r\n      let folder = \"chat_documents\";\r\n      if (type === \"image\") folder = \"chat_images\";\r\n      if (type === \"video\") folder = \"chat_videos\";\r\n\r\n      const storageRef = ref(\r\n        storage,\r\n        `${folder}/${taskId}/${Date.now()}_${file.name}`,\r\n      );\r\n      await uploadBytes(storageRef, file);\r\n      const url = await getDownloadURL(storageRef);\r\n\r\n      const messageData: any = {\r\n        senderId: user.uid,\r\n        createdAt: serverTimestamp(),\r\n        fileName: file.name,\r\n        fileType: file.type,\r\n      };\r\n\r\n      if (type === \"image\") messageData.imageUrl = url;\r\n      else if (type === \"video\") messageData.videoUrl = url;\r\n      else if (type === \"document\") messageData.documentUrl = url;\r\n\r\n      await addDoc(collection(db, \"requests\", taskId, \"messages\"), messageData);\r\n\r\n      // Trigger Notification\r\n      const recipientId =\r\n        user.uid === taskData?.clientId ? taskData?.repId : taskData?.clientId;\r\n      if (recipientId) {\r\n        let notifMsg = \"Te ha enviado un archivo.\";\r\n        if (type === \"image\") notifMsg = \"Te ha enviado una imagen.\";\r\n        if (type === \"video\") notifMsg = \"Te ha enviado un video.\";\r\n\r\n        sendNotification({\r\n          recipientId,\r\n          title: \"Nuevo archivo adjunto\",\r\n          message: `${user.displayName}: ${notifMsg}`,\r\n          type: \"chat\",\r\n          link: `/dashboard/chat?id=${taskId}`,\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error(`Error uploading ${type}:`, error);\r\n      alert(`Error al subir ${type}.`);\r\n    } finally {\r\n      setUploading(false);\r\n      // Clear inputs\r\n      if (fileInputRef.current) fileInputRef.current.value = \"\";\r\n      if (videoInputRef.current) videoInputRef.current.value = \"\";\r\n      if (docInputRef.current) docInputRef.current.value = \"\";\r\n    }\r\n  };\r\n\r\n  // Audio Recording Functions\r\n  const startRecording = async () => {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      const recorder = new MediaRecorder(stream);\r\n\r\n      setMediaRecorder(recorder);\r\n      setAudioChunks([]);\r\n      setIsRecording(true);\r\n      setRecordingTime(0);\r\n\r\n      recorder.ondataavailable = (event) => {\r\n        if (event.data.size > 0) {\r\n          setAudioChunks((prev) => [...prev, event.data]);\r\n        }\r\n      };\r\n\r\n      recorder.onstop = () => {\r\n        // Cleanup happens in effect or separate logic\r\n      };\r\n\r\n      recorder.start();\r\n\r\n      // Timer for UI\r\n      recordingTimerRef.current = setInterval(() => {\r\n        setRecordingTime((prev) => prev + 1);\r\n      }, 1000);\r\n    } catch (err) {\r\n      console.error(\"Error accessing microphone:\", err);\r\n      // alert(\"No se pudo acceder al micr??fono.\"); // Removed alert to avoid annoyance if permissions pending\r\n    }\r\n  };\r\n\r\n  const stopRecording = () => {\r\n    if (mediaRecorder && isRecording) {\r\n      mediaRecorder.stop();\r\n      mediaRecorder.stream.getTracks().forEach((track) => track.stop()); // Stop stream\r\n      setIsRecording(false);\r\n      if (recordingTimerRef.current) clearInterval(recordingTimerRef.current);\r\n    }\r\n  };\r\n\r\n  const cancelRecording = () => {\r\n    setIsRecording(false);\r\n    setAudioChunks([]);\r\n    setAudioBlob(null);\r\n    if (recordingTimerRef.current) clearInterval(recordingTimerRef.current);\r\n    if (mediaRecorder) {\r\n      mediaRecorder.stream.getTracks().forEach((track) => track.stop());\r\n    }\r\n  };\r\n\r\n  const formatTime = (seconds: number) => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = seconds % 60;\r\n    return `${mins}:${secs.toString().padStart(2, \"0\")}`;\r\n  };\r\n\r\n  if (accessDenied) {\r\n    return (\r\n      <div className=\"flex flex-col h-screen items-center justify-center bg-slate-50 dark:bg-slate-900 p-4 text-center\">\r\n        <span className=\"material-symbols-outlined text-6xl text-red-500 mb-4\">\r\n          gpp_maybe\r\n        </span>\r\n        <h1 className=\"text-2xl font-bold text-slate-900 dark:text-white mb-2\">\r\n          Acceso Denegado al Chat\r\n        </h1>\r\n        <p className=\"text-slate-600 dark:text-slate-400 mb-6 max-w-md\">\r\n          No tienes permiso para ver esta conversaci??n. Esto puede suceder si no\r\n          eres parte de la tarea o si hubo un error en la carga.\r\n        </p>\r\n        <button\r\n          onClick={() => router.push(dashboardPath)}\r\n          className=\"bg-primary text-white px-6 py-2 rounded-xl font-medium hover:bg-primary-dark transition\"\r\n        >\r\n          Volver al Panel\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if ((loading || authLoading) && !taskData) {\r\n    return (\r\n      <div className=\"flex h-screen items-center justify-center bg-slate-50 dark:bg-slate-900\">\r\n        <span className=\"w-10 h-10 border-4 border-slate-200 border-t-primary rounded-full animate-spin\"></span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const otherPersonName =\r\n    user?.uid === taskData?.clientId ? taskData?.repName : taskData?.clientName;\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-screen bg-slate-50 dark:bg-slate-900\">\r\n      {/* Header */}\r\n      <header className=\"bg-white dark:bg-[#1a2632] border-b border-slate-200 dark:border-slate-700 p-4 flex items-center gap-4 sticky top-0 z-10 shadow-sm\">\r\n        <button\r\n          onClick={() => router.back()}\r\n          className=\"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors\"\r\n        >\r\n          <span className=\"material-symbols-outlined text-slate-600 dark:text-slate-300\">\r\n            arrow_back\r\n          </span>\r\n        </button>\r\n        <div className=\"flex-1\">\r\n          <h1 className=\"font-bold text-slate-900 dark:text-white truncate text-lg\">\r\n            {taskData?.title}\r\n          </h1>\r\n          <p className=\"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1\">\r\n            <span className=\"w-2 h-2 rounded-full bg-green-500\"></span>\r\n            Chateando con {otherPersonName || \"Usuario\"}\r\n          </p>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Messages Area */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\r\n        {messages.length === 0 ? (\r\n          <div className=\"flex flex-col items-center justify-center h-full text-slate-400 opacity-60\">\r\n            <span className=\"material-symbols-outlined text-6xl mb-2\">\r\n              forum\r\n            </span>\r\n            <p>Inicia la conversaci??n...</p>\r\n          </div>\r\n        ) : (\r\n          messages.map((msg) => {\r\n            const isMe = msg.senderId === user?.uid;\r\n            return (\r\n              <div\r\n                key={msg.id}\r\n                className={`flex ${isMe ? \"justify-end\" : \"justify-start\"}`}\r\n              >\r\n                <div\r\n                  className={`max-w-[85%] px-4 py-3 rounded-2xl text-sm shadow-sm ${\r\n                    isMe\r\n                      ? \"bg-primary text-white rounded-br-none\"\r\n                      : \"bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-200 border border-slate-200 dark:border-slate-700 rounded-bl-none\"\r\n                  }`}\r\n                >\r\n                  {/* Image */}\r\n                  {msg.imageUrl && (\r\n                    <img\r\n                      src={msg.imageUrl}\r\n                      alt=\"Imagen adjunta\"\r\n                      className=\"w-full h-auto rounded-lg mb-2 max-w-[240px] object-cover\"\r\n                    />\r\n                  )}\r\n\r\n                  {/* Video */}\r\n                  {msg.videoUrl && (\r\n                    <video\r\n                      controls\r\n                      src={msg.videoUrl}\r\n                      className=\"w-full max-w-[280px] rounded-lg mb-2\"\r\n                    />\r\n                  )}\r\n\r\n                  {/* Audio */}\r\n                  {msg.audioUrl && (\r\n                    <div className=\"flex items-center gap-2 mb-2 min-w-[200px]\">\r\n                      <audio\r\n                        controls\r\n                        src={msg.audioUrl}\r\n                        className={`h-10 w-full rounded-md ${isMe ? \"\" : \"bg-slate-100\"}`}\r\n                      />\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Document */}\r\n                  {msg.documentUrl && (\r\n                    <a\r\n                      href={msg.documentUrl}\r\n                      target=\"_blank\"\r\n                      rel=\"noopener noreferrer\"\r\n                      className={`flex items-center gap-3 p-3 rounded-xl mb-2 transition-colors ${\r\n                        isMe\r\n                          ? \"bg-white/10 hover:bg-white/20 text-white\"\r\n                          : \"bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-800 dark:text-slate-200\"\r\n                      }`}\r\n                    >\r\n                      <span className=\"material-symbols-outlined text-2xl\">\r\n                        description\r\n                      </span>\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <p className=\"font-bold truncate text-xs\">\r\n                          {msg.fileName || \"Documento\"}\r\n                        </p>\r\n                        <p className=\"opacity-70 text-[10px] uppercase\">\r\n                          {msg.fileType?.split(\"/\").pop() || \"ARCHIVO\"}\r\n                        </p>\r\n                      </div>\r\n                      <span className=\"material-symbols-outlined\">\r\n                        download\r\n                      </span>\r\n                    </a>\r\n                  )}\r\n\r\n                  {msg.text && (\r\n                    <p className=\"whitespace-pre-wrap\">{msg.text}</p>\r\n                  )}\r\n\r\n                  <div\r\n                    className={`flex items-center gap-1 mt-1 ${\r\n                      isMe ? \"justify-end\" : \"\"\r\n                    }`}\r\n                  >\r\n                    <span\r\n                      className={`text-[10px] ${isMe ? \"text-blue-100\" : \"text-slate-400\"}`}\r\n                    >\r\n                      {msg.createdAt?.toDate\r\n                        ? msg.createdAt.toDate().toLocaleTimeString([], {\r\n                            hour: \"2-digit\",\r\n                            minute: \"2-digit\",\r\n                          })\r\n                        : \"Enviando...\"}\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            );\r\n          })\r\n        )}\r\n        <div ref={scrollRef}></div>\r\n      </div>\r\n\r\n      {/* Input Area */}\r\n      <div className=\"p-3 sm:p-4 bg-white dark:bg-[#1a2632] border-t border-slate-200 dark:border-slate-700\">\r\n        {/* Hidden Inputs */}\r\n        <input\r\n          type=\"file\"\r\n          ref={fileInputRef}\r\n          hidden\r\n          accept=\"image/*\"\r\n          onChange={(e) => handleFileUpload(e, \"image\")}\r\n        />\r\n        <input\r\n          type=\"file\"\r\n          ref={videoInputRef}\r\n          hidden\r\n          accept=\"video/*\"\r\n          onChange={(e) => handleFileUpload(e, \"video\")}\r\n        />\r\n        <input\r\n          type=\"file\"\r\n          ref={docInputRef}\r\n          hidden\r\n          accept=\".pdf,.doc,.docx,.txt,.xls,.xlsx\"\r\n          onChange={(e) => handleFileUpload(e, \"document\")}\r\n        />\r\n\r\n        {/* Audio Recording UI */}\r\n        {audioBlob ? (\r\n          <div className=\"flex items-center gap-4 py-2 px-4 bg-slate-50 dark:bg-slate-800 rounded-xl mb-2\">\r\n            <div className=\"flex-1 flex items-center gap-3\">\r\n              <span className=\"material-symbols-outlined text-red-500\">\r\n                mic\r\n              </span>\r\n              <span className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">\r\n                Audio grabado\r\n              </span>\r\n              <audio\r\n                controls\r\n                src={URL.createObjectURL(audioBlob)}\r\n                className=\"h-8 w-48\"\r\n              />\r\n            </div>\r\n            <button\r\n              onClick={() => setAudioBlob(null)}\r\n              className=\"p-2 text-slate-400 hover:text-red-500 transition-colors\"\r\n            >\r\n              <span className=\"material-symbols-outlined\">delete</span>\r\n            </button>\r\n            <button\r\n              onClick={() => handleSendMessage()}\r\n              className=\"bg-primary text-white p-2 px-4 rounded-lg text-sm font-bold hover:bg-primary-dark transition-colors\"\r\n            >\r\n              Enviar Audio\r\n            </button>\r\n          </div>\r\n        ) : isRecording ? (\r\n          <div className=\"flex items-center justify-between py-3 px-4 bg-red-50 dark:bg-red-900/20 rounded-xl border border-red-100 dark:border-red-900/50 animate-pulse\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <span className=\"material-symbols-outlined text-red-500 animate-pulse\">\r\n                radio_button_checked\r\n              </span>\r\n              <span className=\"font-mono font-bold text-red-600 dark:text-red-400\">\r\n                {formatTime(recordingTime)}\r\n              </span>\r\n              <span className=\"text-sm text-slate-500\">Grabando...</span>\r\n            </div>\r\n            <div className=\"flex gap-2\">\r\n              <button\r\n                onClick={cancelRecording}\r\n                className=\"p-2 text-slate-400 hover:text-red-500 transition-colors bg-white dark:bg-slate-800 rounded-full shadow-sm\"\r\n              >\r\n                <span className=\"material-symbols-outlined\">close</span>\r\n              </button>\r\n              <button\r\n                onClick={stopRecording}\r\n                className=\"p-2 text-white bg-red-500 hover:bg-red-600 transition-colors rounded-full shadow-sm\"\r\n              >\r\n                <span className=\"material-symbols-outlined\">check</span>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <form onSubmit={handleSendMessage} className=\"flex items-end gap-2\">\r\n            {/* Attachments Menu */}\r\n            <div className=\"flex gap-1\" id=\"attachments-menu\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => fileInputRef.current?.click()}\r\n                disabled={uploading}\r\n                className=\"p-3 text-slate-400 hover:text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-xl transition-colors disabled:opacity-50\"\r\n                title=\"Imagen\"\r\n              >\r\n                <span className=\"material-symbols-outlined\">image</span>\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => videoInputRef.current?.click()}\r\n                disabled={uploading}\r\n                className=\"p-3 text-slate-400 hover:text-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-xl transition-colors disabled:opacity-50\"\r\n                title=\"Video\"\r\n              >\r\n                <span className=\"material-symbols-outlined\">videocam</span>\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => docInputRef.current?.click()}\r\n                disabled={uploading}\r\n                className=\"p-3 text-slate-400 hover:text-orange-500 hover:bg-orange-50 dark:hover:bg-orange-900/20 rounded-xl transition-colors disabled:opacity-50\"\r\n                title=\"Documento\"\r\n              >\r\n                <span className=\"material-symbols-outlined\">attach_file</span>\r\n              </button>\r\n            </div>\r\n\r\n            {/* Input */}\r\n            <div className=\"flex-1 bg-slate-100 dark:bg-slate-900 rounded-2xl flex items-center px-2 border-2 border-transparent focus-within:border-primary/50 transition-all\">\r\n              <textarea\r\n                value={newMessage}\r\n                onChange={(e) => setNewMessage(e.target.value)}\r\n                placeholder=\"Escribe un mensaje...\"\r\n                className=\"flex-1 bg-transparent border-0 text-slate-900 dark:text-white focus:ring-0 resize-none py-3 max-h-32 min-h-[44px]\"\r\n                rows={1}\r\n                onKeyDown={(e) => {\r\n                  if (e.key === \"Enter\" && !e.shiftKey) {\r\n                    e.preventDefault();\r\n                    handleSendMessage(e);\r\n                  }\r\n                }}\r\n              />\r\n            </div>\r\n\r\n            {newMessage.trim() ? (\r\n              <button\r\n                type=\"submit\"\r\n                disabled={uploading}\r\n                className=\"bg-primary text-white p-3 rounded-xl hover:bg-primary-dark transition-colors disabled:opacity-50 shadow-md shadow-blue-500/20\"\r\n              >\r\n                <span className=\"material-symbols-outlined\">send</span>\r\n              </button>\r\n            ) : (\r\n              <button\r\n                type=\"button\"\r\n                onClick={startRecording}\r\n                disabled={uploading}\r\n                className=\"bg-slate-200 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 p-3 rounded-xl transition-colors disabled:opacity-50\"\r\n              >\r\n                <span className=\"material-symbols-outlined\">mic</span>\r\n              </button>\r\n            )}\r\n          </form>\r\n        )}\r\n      </div>\r\n\r\n      {/* Mobile Overflow Styles Fix */}\r\n      <style jsx>{`\r\n        #attachments-menu button {\r\n          /* Ensure buttons are touch-friendly */\r\n          min-width: 44px;\r\n        }\r\n        @media (max-width: 640px) {\r\n          #attachments-menu {\r\n            /* On small screens, maybe just show fewer or use efficient spacing */\r\n            gap: 0;\r\n          }\r\n          #attachments-menu button {\r\n            padding: 0.5rem;\r\n          }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function ChatPage() {\r\n  return (\r\n    <Suspense\r\n      fallback={\r\n        <div className=\"h-screen flex items-center justify-center\">\r\n          Cargando chat...\r\n        </div>\r\n      }\r\n    >\r\n      <ChatContent />\r\n    </Suspense>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Usuario\\OneDrive\\Desktop\\Antigravity\\Personas de Confianza\\personas-de-confianza\\app\\dashboard\\client\\new-request\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Usuario\\OneDrive\\Desktop\\Antigravity\\Personas de Confianza\\personas-de-confianza\\app\\dashboard\\client\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":290,"column":19,"nodeType":"JSXOpeningElement","endLine":297,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Usuario\\OneDrive\\Desktop\\Antigravity\\Personas de Confianza\\personas-de-confianza\\app\\dashboard\\client\\payment-failure\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'status' is assigned a value but never used.","line":12,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState, Suspense } from \"react\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\n\r\nfunction PaymentFailureContent() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  const [countdown, setCountdown] = useState(10);\r\n\r\n  const requestId = searchParams.get(\"requestId\");\r\n  const status = searchParams.get(\"status\");\r\n  const statusDetail = searchParams.get(\"status_detail\");\r\n\r\n  useEffect(() => {\r\n    if (countdown === 0) {\r\n      router.push(\"/dashboard/client\");\r\n      return;\r\n    }\r\n\r\n    const timer = setTimeout(() => {\r\n      setCountdown(countdown - 1);\r\n    }, 1000);\r\n\r\n    return () => clearTimeout(timer);\r\n  }, [countdown, router]);\r\n\r\n  // Traducir mensajes de error\r\n  const getErrorMessage = () => {\r\n    if (statusDetail === \"cc_rejected_insufficient_amount\") {\r\n      return \"Fondos insuficientes en la tarjeta\";\r\n    }\r\n    if (statusDetail === \"cc_rejected_bad_filled_security_code\") {\r\n      return \"C??digo de seguridad incorrecto\";\r\n    }\r\n    if (statusDetail === \"cc_rejected_call_for_authorize\") {\r\n      return \"Debes autorizar el pago con tu banco\";\r\n    }\r\n    return \"El pago fue rechazado. Por favor, intenta nuevamente.\";\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-red-50 via-white to-orange-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex items-center justify-center p-4\">\r\n      <div className=\"max-w-md w-full\">\r\n        {/* Failure Card */}\r\n        <div className=\"bg-white dark:bg-slate-800 rounded-3xl shadow-2xl overflow-hidden\">\r\n          {/* Header */}\r\n          <div className=\"bg-gradient-to-r from-red-500 to-orange-600 p-8 text-center\">\r\n            <div className=\"w-24 h-24 bg-white rounded-full mx-auto flex items-center justify-center\">\r\n              <span className=\"material-symbols-outlined text-6xl text-red-500\">\r\n                cancel\r\n              </span>\r\n            </div>\r\n            <h1 className=\"text-2xl font-bold text-white mt-4\">\r\n              Pago Rechazado\r\n            </h1>\r\n            <p className=\"text-red-100 mt-2\">No se pudo procesar tu pago</p>\r\n          </div>\r\n\r\n          {/* Content */}\r\n          <div className=\"p-8\">\r\n            <div className=\"space-y-4\">\r\n              {/* Error Message */}\r\n              <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4\">\r\n                <div className=\"flex gap-3\">\r\n                  <span className=\"material-symbols-outlined text-red-600 dark:text-red-400\">\r\n                    error\r\n                  </span>\r\n                  <div>\r\n                    <p className=\"text-sm text-red-900 dark:text-red-100 font-semibold mb-1\">\r\n                      Motivo del rechazo\r\n                    </p>\r\n                    <p className=\"text-sm text-red-700 dark:text-red-300\">\r\n                      {getErrorMessage()}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Suggestions */}\r\n              <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4\">\r\n                <div className=\"flex gap-3\">\r\n                  <span className=\"material-symbols-outlined text-blue-600 dark:text-blue-400\">\r\n                    lightbulb\r\n                  </span>\r\n                  <div>\r\n                    <p className=\"text-sm text-blue-900 dark:text-blue-100 font-semibold mb-2\">\r\n                      Sugerencias\r\n                    </p>\r\n                    <ul className=\"text-sm text-blue-700 dark:text-blue-300 space-y-1 list-disc list-inside\">\r\n                      <li>\r\n                        Verifica que los datos de tu tarjeta sean correctos\r\n                      </li>\r\n                      <li>Aseg??rate de tener fondos suficientes</li>\r\n                      <li>Intenta con otro m??todo de pago</li>\r\n                      <li>Contacta a tu banco si el problema persiste</li>\r\n                    </ul>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Countdown */}\r\n              <div className=\"text-center pt-4\">\r\n                <p className=\"text-sm text-slate-500 dark:text-slate-400\">\r\n                  Redirigiendo al panel en{\" \"}\r\n                  <span className=\"font-bold text-primary\">{countdown}</span>{\" \"}\r\n                  segundos...\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Actions */}\r\n            <div className=\"mt-6 space-y-3\">\r\n              <button\r\n                onClick={() =>\r\n                  router.push(`/dashboard/client?retry=${requestId}`)\r\n                }\r\n                className=\"w-full bg-primary hover:bg-primary-dark text-white font-semibold py-3 px-6 rounded-xl transition-colors flex items-center justify-center gap-2\"\r\n              >\r\n                <span className=\"material-symbols-outlined\">refresh</span>\r\n                <span>Intentar Nuevamente</span>\r\n              </button>\r\n              <button\r\n                onClick={() => router.push(\"/dashboard/client\")}\r\n                className=\"w-full bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 font-semibold py-3 px-6 rounded-xl transition-colors flex items-center justify-center gap-2\"\r\n              >\r\n                <span className=\"material-symbols-outlined\">dashboard</span>\r\n                <span>Volver al Panel</span>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Support */}\r\n        <div className=\"mt-6 text-center\">\r\n          <p className=\"text-xs text-slate-500 dark:text-slate-400\">\r\n            ??Necesitas ayuda?{\" \"}\r\n            <a\r\n              href=\"/settings\"\r\n              className=\"text-primary hover:underline font-semibold\"\r\n            >\r\n              Contacta soporte\r\n            </a>\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function PaymentFailurePage() {\r\n  return (\r\n    <Suspense\r\n      fallback={\r\n        <div className=\"min-h-screen flex items-center justify-center\">\r\n          <span className=\"w-10 h-10 border-4 border-slate-200 border-t-primary rounded-full animate-spin\"></span>\r\n        </div>\r\n      }\r\n    >\r\n      <PaymentFailureContent />\r\n    </Suspense>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Usuario\\OneDrive\\Desktop\\Antigravity\\Personas de Confianza\\personas-de-confianza\\app\\dashboard\\client\\payment-pending\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Usuario\\OneDrive\\Desktop\\Antigravity\\Personas de Confianza\\personas-de-confianza\\app\\dashboard\\client\\payment-success\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":10,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState, Suspense } from \"react\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\nimport { useAuth } from \"@/components/AuthProvider\";\r\n\r\nfunction PaymentSuccessContent() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  const { user } = useAuth();\r\n  const [countdown, setCountdown] = useState(5);\r\n\r\n  const requestId = searchParams.get(\"requestId\");\r\n  const paymentId = searchParams.get(\"payment_id\");\r\n  const status = searchParams.get(\"status\");\r\n\r\n  useEffect(() => {\r\n    if (countdown === 0) {\r\n      router.push(\"/dashboard/client\");\r\n      return;\r\n    }\r\n\r\n    const timer = setTimeout(() => {\r\n      setCountdown(countdown - 1);\r\n    }, 1000);\r\n\r\n    return () => clearTimeout(timer);\r\n  }, [countdown, router]);\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-green-50 via-white to-blue-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex items-center justify-center p-4\">\r\n      <div className=\"max-w-md w-full\">\r\n        {/* Success Card */}\r\n        <div className=\"bg-white dark:bg-slate-800 rounded-3xl shadow-2xl overflow-hidden\">\r\n          {/* Header with animation */}\r\n          <div className=\"bg-gradient-to-r from-green-500 to-emerald-600 p-8 text-center\">\r\n            <div className=\"w-24 h-24 bg-white rounded-full mx-auto flex items-center justify-center animate-bounce\">\r\n              <span className=\"material-symbols-outlined text-6xl text-green-500\">\r\n                check_circle\r\n              </span>\r\n            </div>\r\n            <h1 className=\"text-2xl font-bold text-white mt-4\">\r\n              ??Pago Exitoso!\r\n            </h1>\r\n            <p className=\"text-green-100 mt-2\">\r\n              Tu pago ha sido procesado correctamente\r\n            </p>\r\n          </div>\r\n\r\n          {/* Content */}\r\n          <div className=\"p-8\">\r\n            <div className=\"space-y-4\">\r\n              {/* Payment ID */}\r\n              {paymentId && (\r\n                <div className=\"bg-slate-50 dark:bg-slate-700 rounded-xl p-4\">\r\n                  <p className=\"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold mb-1\">\r\n                    ID de Pago\r\n                  </p>\r\n                  <p className=\"text-sm font-mono text-slate-700 dark:text-slate-300\">\r\n                    {paymentId}\r\n                  </p>\r\n                </div>\r\n              )}\r\n\r\n              {/* Status */}\r\n              {status && (\r\n                <div className=\"bg-slate-50 dark:bg-slate-700 rounded-xl p-4\">\r\n                  <p className=\"text-xs text-slate-500 dark:text-slate-400 uppercase font-semibold mb-1\">\r\n                    Estado\r\n                  </p>\r\n                  <p className=\"text-sm font-semibold text-green-600 dark:text-green-400\">\r\n                    {status === \"approved\" ? \"Aprobado\" : status}\r\n                  </p>\r\n                </div>\r\n              )}\r\n\r\n              {/* Info */}\r\n              <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4\">\r\n                <div className=\"flex gap-3\">\r\n                  <span className=\"material-symbols-outlined text-blue-600 dark:text-blue-400\">\r\n                    info\r\n                  </span>\r\n                  <div>\r\n                    <p className=\"text-sm text-blue-900 dark:text-blue-100 font-semibold mb-1\">\r\n                      ??Qu?? sigue?\r\n                    </p>\r\n                    <p className=\"text-sm text-blue-700 dark:text-blue-300\">\r\n                      El dinero quedar?? en custodia hasta que el servicio se\r\n                      complete satisfactoriamente y ambas partes se califiquen.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Countdown */}\r\n              <div className=\"text-center pt-4\">\r\n                <p className=\"text-sm text-slate-500 dark:text-slate-400\">\r\n                  Redirigiendo a tu panel en{\" \"}\r\n                  <span className=\"font-bold text-primary\">{countdown}</span>{\" \"}\r\n                  segundos...\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Actions */}\r\n            <div className=\"mt-6 space-y-3\">\r\n              <button\r\n                onClick={() => router.push(`/dashboard/chat?id=${requestId}`)}\r\n                className=\"w-full bg-primary hover:bg-primary-dark text-white font-semibold py-3 px-6 rounded-xl transition-colors flex items-center justify-center gap-2\"\r\n              >\r\n                <span className=\"material-symbols-outlined\">chat</span>\r\n                <span>Ir al Chat del Servicio</span>\r\n              </button>\r\n              <button\r\n                onClick={() => router.push(\"/dashboard/client\")}\r\n                className=\"w-full bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 font-semibold py-3 px-6 rounded-xl transition-colors flex items-center justify-center gap-2\"\r\n              >\r\n                <span className=\"material-symbols-outlined\">dashboard</span>\r\n                <span>Volver al Panel</span>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Security Badge */}\r\n        <div className=\"mt-6 text-center\">\r\n          <p className=\"text-xs text-slate-500 dark:text-slate-400 flex items-center justify-center gap-1\">\r\n            <span className=\"material-symbols-outlined text-sm\">lock</span>\r\n            Pago procesado de forma segura por Mercado Pago\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function PaymentSuccessPage() {\r\n  return (\r\n    <Suspense\r\n      fallback={\r\n        <div className=\"min-h-screen flex items-center justify-center\">\r\n          <span className=\"w-10 h-10 border-4 border-slate-200 border-t-primary rounded-full animate-spin\"></span>\r\n        </div>\r\n      }\r\n    >\r\n      <PaymentSuccessContent />\r\n    </Suspense>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Usuario\\OneDrive\\Desktop\\Antigravity\\Personas de Confianza\\personas-de-confianza\\app\\dashboard\\rep\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":279,"column":19,"nodeType":"JSXOpeningElement","endLine":286,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Usuario\\OneDrive\\Desktop\\Antigravity\\Personas de Confianza\\personas-de-confianza\\app\\dashboard\\rep\\tasks\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Usuario\\OneDrive\\Desktop\\Antigravity\\Personas de Confianza\\personas-de-confianza\\app\\layout.tsx","messages":[{"ruleId":"@next/next/google-font-display","severity":1,"message":"A font-display parameter is missing (adding `&display=optional` is recommended). See: https://nextjs.org/docs/messages/google-font-display","line":18,"column":9,"nodeType":"JSXOpeningElement","endLine":21,"endColumn":11},{"ruleId":"@next/next/no-page-custom-font","severity":1,"message":"Custom fonts not added in `pages/_document.js` will only load for a single page. This is discouraged. See: https://nextjs.org/docs/messages/no-page-custom-font","line":18,"column":9,"nodeType":"JSXOpeningElement","endLine":21,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Metadata } from \"next\";\nimport \"./globals.css\";\nimport { AuthProvider } from \"@/components/AuthProvider\";\n\nexport const metadata: Metadata = {\n  title: \"Personas de Confianza\",\n  description: \"La confianza que acorta distancias.\",\n};\n\nexport default function RootLayout({\n  children,\n}: Readonly<{\n  children: React.ReactNode;\n}>) {\n  return (\n    <html lang=\"es\">\n      <head>\n        <link\n          rel=\"stylesheet\"\n          href=\"https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0\"\n        />\n      </head>\n      <body className=\"antialiased bg-background text-foreground font-sans\">\n        <AuthProvider>{children}</AuthProvider>\n      </body>\n    </html>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Usuario\\OneDrive\\Desktop\\Antigravity\\Personas de Confianza\\personas-de-confianza\\app\\messages\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Usuario\\OneDrive\\Desktop\\Antigravity\\Personas de Confianza\\personas-de-confianza\\app\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":18,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"useState"},"fix":{"range":[77,110],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport Link from \"next/link\";\nimport Image from \"next/image\";\nimport { useState } from \"react\";\n\nexport default function Home() {\n  return (\n    <div className=\"min-h-screen bg-background font-sans text-foreground overflow-x-hidden\">\n      {/* Floating Navbar */}\n      <nav className=\"fixed top-4 left-4 right-4 z-50 bg-white/90 backdrop-blur-md border border-white/20 shadow-lg rounded-2xl px-6 py-4 flex items-center justify-between max-w-7xl mx-auto transition-all duration-300\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-8 bg-cta rounded-lg flex items-center justify-center text-white font-bold\">\n            P\n          </div>\n          <span className=\"text-xl font-heading font-bold text-foreground tracking-tight\">\n            Personas de Confianza\n          </span>\n        </div>\n        <div className=\"hidden md:flex items-center gap-8\">\n          <Link\n            href=\"/search\"\n            className=\"text-sm font-medium text-slate-600 hover:text-primary transition-colors\"\n          >\n            Buscar\n          </Link>\n          <Link\n            href=\"/how-it-works\"\n            className=\"text-sm font-medium text-slate-600 hover:text-primary transition-colors\"\n          >\n            C??mo funciona\n          </Link>\n          <Link\n            href=\"/pricing\"\n            className=\"text-sm font-medium text-slate-600 hover:text-primary transition-colors\"\n          >\n            Precios\n          </Link>\n        </div>\n        <div className=\"flex items-center gap-4\">\n          <Link\n            href=\"/auth?mode=login\"\n            className=\"text-sm font-medium text-primary hover:text-primary/80 transition-colors\"\n          >\n            Iniciar sesi??n\n          </Link>\n          <Link\n            href=\"/auth?mode=signup\"\n            className=\"btn-primary py-2 px-4 text-sm shadow-md hover:shadow-lg\"\n          >\n            Registrarse\n          </Link>\n        </div>\n      </nav>\n\n      {/* Hero Section */}\n      <section className=\"relative pt-32 pb-20 lg:pt-48 lg:pb-32 overflow-hidden\">\n        <div className=\"absolute inset-0 z-0\">\n          <div className=\"absolute top-0 left-1/2 -translate-x-1/2 w-full h-full max-w-7xl opacity-30 pointer-events-none\">\n            <div className=\"absolute top-20 left-10 w-72 h-72 bg-purple-300 rounded-full mix-blend-multiply filter blur-3xl animate-blob\"></div>\n            <div className=\"absolute top-20 right-10 w-72 h-72 bg-green-300 rounded-full mix-blend-multiply filter blur-3xl animate-blob animation-delay-2000\"></div>\n            <div className=\"absolute -bottom-8 left-20 w-72 h-72 bg-blue-300 rounded-full mix-blend-multiply filter blur-3xl animate-blob animation-delay-4000\"></div>\n          </div>\n        </div>\n\n        <div className=\"relative z-10 container mx-auto px-4 text-center\">\n          <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/50 border border-purple-100 text-purple-700 text-xs font-medium mb-6 animate-fade-in-up\">\n            <span className=\"w-2 h-2 rounded-full bg-green-500 animate-pulse\"></span>\n            La plataforma #1 de verificaci??n en LatAm\n          </div>\n\n          <h1 className=\"text-4xl md:text-5xl lg:text-7xl font-heading font-bold text-foreground tracking-tight mb-6 max-w-4xl mx-auto leading-tight\">\n            Contrata con{\" \"}\n            <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-primary to-cta\">\n              Confianza Total\n            </span>\n          </h1>\n\n          <p className=\"text-lg md:text-xl text-slate-600 mb-10 max-w-2xl mx-auto leading-relaxed\">\n            Verificamos identidad, antecedentes y reputaci??n para que puedas\n            realizar transacciones seguras. Tu seguridad es nuestra prioridad.\n          </p>\n\n          {/* Search Bar - Marketplace Style */}\n          <div className=\"max-w-3xl mx-auto bg-white p-2 rounded-2xl shadow-xl border border-slate-100 flex flex-col md:flex-row gap-2 transition-transform hover:scale-[1.01] duration-300\">\n            <div className=\"flex-1 flex items-center px-4 bg-slate-50 rounded-xl border border-transparent focus-within:border-primary/20 focus-within:bg-white transition-all\">\n              <span className=\"material-symbols-outlined text-slate-400 mr-3\">\n                search\n              </span>\n              <input\n                type=\"text\"\n                placeholder=\"??A qui??n est??s buscando? (Nombre, DNI, Email)\"\n                className=\"w-full bg-transparent border-none focus:ring-0 text-foreground placeholder:text-slate-400 h-12 outline-none\"\n              />\n            </div>\n            <button className=\"btn-primary h-14 md:h-auto md:px-8 text-lg shadow-lg hover:shadow-xl flex items-center justify-center gap-2\">\n              Buscar\n              <span className=\"material-symbols-outlined text-[20px]\">\n                arrow_forward\n              </span>\n            </button>\n          </div>\n\n          {/* Trust Indicators */}\n          <div className=\"mt-12 flex flex-wrap justify-center gap-6 md:gap-12 opacity-80\">\n            <div className=\"flex items-center gap-2\">\n              <span className=\"material-symbols-outlined text-green-500\">\n                verified_user\n              </span>\n              <span className=\"text-sm font-medium text-slate-600\">\n                Verificaci??n de Identidad\n              </span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"material-symbols-outlined text-green-500\">\n                gavel\n              </span>\n              <span className=\"text-sm font-medium text-slate-600\">\n                Antecedentes Penales\n              </span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"material-symbols-outlined text-green-500\">\n                lock\n              </span>\n              <span className=\"text-sm font-medium text-slate-600\">\n                Pagos en Escrow\n              </span>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Features Grid (Bento Style) */}\n      <section className=\"py-20 bg-white\">\n        <div className=\"container mx-auto px-4\">\n          <h2 className=\"text-3xl md:text-4xl font-heading font-bold text-center mb-16\">\n            ??Por qu?? elegir{\" \"}\n            <span className=\"text-primary\">Personas de Confianza</span>?\n          </h2>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-6xl mx-auto\">\n            {/* Feature 1 */}\n            <div className=\"col-span-1 md:col-span-2 card bg-purple-50 border-purple-100 relative overflow-hidden group hover:shadow-lg transition-all duration-300\">\n              <div className=\"relative z-10\">\n                <div className=\"w-12 h-12 bg-white rounded-xl shadow-sm flex items-center justify-center mb-6 text-primary\">\n                  <span className=\"material-symbols-outlined\">fingerprint</span>\n                </div>\n                <h3 className=\"text-xl font-bold mb-3\">\n                  Verificaci??n Biom??trica Avanzada\n                </h3>\n                <p className=\"text-slate-600 max-w-md\">\n                  Utilizamos tecnolog??a de punta para validar la identidad de\n                  cada usuario mediante reconocimiento facial y validaci??n de\n                  documentos oficiales en tiempo real.\n                </p>\n              </div>\n              <div className=\"absolute right-0 bottom-0 w-64 h-64 bg-gradient-to-tl from-purple-200/50 to-transparent rounded-tl-full translate-x-10 translate-y-10 group-hover:translate-x-5 group-hover:translate-y-5 transition-transform duration-500\"></div>\n            </div>\n\n            {/* Feature 2 */}\n            <div className=\"col-span-1 card border-slate-100 hover:border-cta/20 group hover:shadow-lg transition-all duration-300\">\n              <div className=\"w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center mb-6 text-cta\">\n                <span className=\"material-symbols-outlined\">shield</span>\n              </div>\n              <h3 className=\"text-xl font-bold mb-3\">Escrow Seguro</h3>\n              <p className=\"text-slate-600\">\n                Tu dinero est?? protegido hasta que el servicio se complete\n                satisfactoriamente.\n              </p>\n            </div>\n\n            {/* Feature 3 */}\n            <div className=\"col-span-1 card border-slate-100 hover:border-primary/20 group hover:shadow-lg transition-all duration-300\">\n              <div className=\"w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center mb-6 text-blue-500\">\n                <span className=\"material-symbols-outlined\">history</span>\n              </div>\n              <h3 className=\"text-xl font-bold mb-3\">Historial Transparente</h3>\n              <p className=\"text-slate-600\">\n                Accede al historial de reputaci??n y calificaciones verificadas\n                de cada usuario.\n              </p>\n            </div>\n\n            {/* Feature 4 */}\n            <div className=\"col-span-1 md:col-span-2 card bg-slate-900 text-white relative overflow-hidden group hover:shadow-lg transition-all duration-300\">\n              <div className=\"relative z-10\">\n                <div className=\"w-12 h-12 bg-white/10 rounded-xl backdrop-blur-sm flex items-center justify-center mb-6 text-cta\">\n                  <span className=\"material-symbols-outlined\">\n                    rocket_launch\n                  </span>\n                </div>\n                <h3 className=\"text-xl font-bold mb-3\">API para Empresas</h3>\n                <p className=\"text-slate-300 max-w-md\">\n                  Integra nuestro sistema de verificaci??n directamente en tu\n                  plataforma con nuestra API robusta y documentada.\n                </p>\n                <button className=\"mt-6 text-sm font-semibold text-cta flex items-center gap-1 hover:gap-2 transition-all\">\n                  Leer documentaci??n{\" \"}\n                  <span className=\"material-symbols-outlined text-sm\">\n                    arrow_forward\n                  </span>\n                </button>\n              </div>\n              <div className=\"absolute right-0 top-0 w-full h-full bg-[url('/grid-pattern.svg')] opacity-10\"></div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Use Cases (Cards with Image) */}\n      <section className=\"py-24 bg-slate-50\">\n        <div className=\"max-w-7xl mx-auto px-6\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl md:text-5xl font-heading font-bold text-foreground mb-6\">\n              Soluciones para cada necesidad\n            </h2>\n            <p className=\"text-xl text-slate-500 max-w-2xl mx-auto\">\n              Ya sea para uso personal o comercial, eliminamos la incertidumbre\n              de tus interacciones.\n            </p>\n          </div>\n\n          <div className=\"grid md:grid-cols-3 gap-8\">\n            {[\n              {\n                title: \"Compra de Veh??culos\",\n                desc: \"Verifica el estado mec??nico y legal antes de viajar.\",\n                image:\n                  \"https://images.unsplash.com/photo-1492144534655-ae79c964c9d7?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80\",\n                icon: \"directions_car\",\n              },\n              {\n                title: \"Alquileres Temporales\",\n                desc: \"Confirma que la propiedad existe y coincide con las fotos.\",\n                image:\n                  \"https://images.unsplash.com/photo-1564013799919-ab600027ffc6?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80\",\n                icon: \"cottage\",\n              },\n              {\n                title: \"Tr??mites Legales\",\n                desc: \"Gesti??n de documentos en instituciones p??blicas.\",\n                image:\n                  \"https://images.unsplash.com/photo-1450101499163-c8848c66ca85?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80\",\n                icon: \"description\",\n              },\n            ].map((item, idx) => (\n              <div\n                key={idx}\n                className=\"group card p-0 overflow-hidden border-0 bg-white hover:-translate-y-2 transition-transform duration-300\"\n              >\n                <div className=\"h-48 relative overflow-hidden\">\n                  <div className=\"absolute inset-0 bg-slate-900/10 group-hover:bg-transparent transition-colors z-10\"></div>\n                  <Image\n                    src={item.image}\n                    alt={item.title}\n                    fill\n                    className=\"object-cover transition-transform duration-700 group-hover:scale-110\"\n                  />\n                </div>\n                <div className=\"p-8\">\n                  <div className=\"w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center text-primary mb-4\">\n                    <span className=\"material-symbols-outlined\">\n                      {item.icon}\n                    </span>\n                  </div>\n                  <h3 className=\"text-xl font-bold mb-2\">{item.title}</h3>\n                  <p className=\"text-slate-600 mb-6\">{item.desc}</p>\n                  <Link\n                    href=\"/auth?mode=signup\"\n                    className=\"text-primary font-bold flex items-center gap-1 hover:gap-2 transition-all\"\n                  >\n                    Empezar{\" \"}\n                    <span className=\"material-symbols-outlined text-sm\">\n                      arrow_forward\n                    </span>\n                  </Link>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"bg-white border-t border-slate-100 py-12\">\n        <div className=\"max-w-7xl mx-auto px-6 grid md:grid-cols-4 gap-8\">\n          <div className=\"col-span-1 md:col-span-2\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <div className=\"w-6 h-6 bg-cta rounded flex items-center justify-center text-white text-xs font-bold\">\n                P\n              </div>\n              <span className=\"font-bold text-lg\">Personas de Confianza</span>\n            </div>\n            <p className=\"text-slate-500 max-w-sm\">\n              La plataforma l??der en verificaci??n de confianza para\n              transacciones entre personas. Seguridad, transparencia y rapidez.\n            </p>\n          </div>\n          <div>\n            <h4 className=\"font-bold mb-4\">Plataforma</h4>\n            <ul className=\"space-y-2 text-slate-500\">\n              <li>\n                <Link href=\"#\" className=\"hover:text-primary\">\n                  Para Clientes\n                </Link>\n              </li>\n              <li>\n                <Link href=\"#\" className=\"hover:text-primary\">\n                  Para Profesionales\n                </Link>\n              </li>\n              <li>\n                <Link href=\"#\" className=\"hover:text-primary\">\n                  Precios\n                </Link>\n              </li>\n              <li>\n                <Link href=\"#\" className=\"hover:text-primary\">\n                  Empresas (API)\n                </Link>\n              </li>\n            </ul>\n          </div>\n          <div>\n            <h4 className=\"font-bold mb-4\">Legales</h4>\n            <ul className=\"space-y-2 text-slate-500\">\n              <li>\n                <Link href=\"#\" className=\"hover:text-primary\">\n                  T??rminos y Condiciones\n                </Link>\n              </li>\n              <li>\n                <Link href=\"#\" className=\"hover:text-primary\">\n                  Pol??tica de Privacidad\n                </Link>\n              </li>\n              <li>\n                <Link href=\"#\" className=\"hover:text-primary\">\n                  Centro de Ayuda\n                </Link>\n              </li>\n            </ul>\n          </div>\n        </div>\n        <div className=\"max-w-7xl mx-auto px-6 mt-12 pt-8 border-t border-slate-100 text-center text-slate-400 text-sm\">\n          ?? {new Date().getFullYear()} Personas de Confianza. Todos los derechos\n          reservados.\n        </div>\n      </footer>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Usuario\\OneDrive\\Desktop\\Antigravity\\Personas de Confianza\\personas-de-confianza\\app\\settings\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[841,844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[841,844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1616,1619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1616,1619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1667,1670],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1667,1670],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1729,1732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1729,1732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1796,1799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1796,1799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1871,1874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1871,1874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTransactions'. Either include it or remove the dependency array.","line":56,"column":6,"nodeType":"ArrayExpression","endLine":56,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, fetchTransactions, user]","fix":{"range":[2118,2135],"text":"[activeTab, fetchTransactions, user]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":215,"column":21,"nodeType":"JSXOpeningElement","endLine":223,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":751,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":751,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36896,36899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36896,36899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useRef, useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { useAuth } from \"@/components/AuthProvider\";\r\nimport { storage } from \"@/lib/firebase\";\r\nimport { updateProfile } from \"firebase/auth\";\r\nimport { ref, uploadBytes, getDownloadURL } from \"firebase/storage\";\r\n\r\nexport default function SettingsPage() {\r\n  const { user, userData } = useAuth();\r\n  const [activeTab, setActiveTab] = useState(\"perfil\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [name, setName] = useState(\"\");\r\n  // Professional Info State\r\n  const [profession, setProfession] = useState(\"\");\r\n  const [specialization, setSpecialization] = useState(\"\");\r\n  const [address, setAddress] = useState(\"\");\r\n  const [schedule, setSchedule] = useState(\"\");\r\n  const [transactions, setTransactions] = useState<any[]>([]);\r\n  const [loadingTransactions, setLoadingTransactions] = useState(false);\r\n\r\n  // Financial Info State (Rep only)\r\n  const [cbu, setCbu] = useState(\"\");\r\n  const [alias, setAlias] = useState(\"\");\r\n  const [bankName, setBankName] = useState(\"\");\r\n  const [accountHolder, setAccountHolder] = useState(\"\");\r\n\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // Load user data into state\r\n  useEffect(() => {\r\n    if (user) {\r\n      setName(user.displayName || \"\");\r\n    }\r\n    if (userData) {\r\n      setProfession(userData.profession || \"\");\r\n      setSpecialization(userData.specialization || \"\");\r\n      setAddress(userData.address || \"\");\r\n      setAddress(userData.address || \"\");\r\n      setSchedule(userData.schedule || \"\");\r\n      if ((userData as any).financialInfo) {\r\n        setCbu((userData as any).financialInfo.cbu || \"\");\r\n        setAlias((userData as any).financialInfo.alias || \"\");\r\n        setBankName((userData as any).financialInfo.bankName || \"\");\r\n        setAccountHolder((userData as any).financialInfo.accountHolder || \"\");\r\n      }\r\n    }\r\n  }, [user, userData]);\r\n\r\n  // Fetch transactions when activeTab changes to \"pagos\"\r\n  useEffect(() => {\r\n    if (activeTab === \"pagos\" && user) {\r\n      fetchTransactions();\r\n    }\r\n  }, [activeTab, user]);\r\n\r\n  const fetchTransactions = async () => {\r\n    if (!user) return;\r\n    setLoadingTransactions(true);\r\n    try {\r\n      const { collection, query, where, getDocs, orderBy } =\r\n        await import(\"firebase/firestore\");\r\n      const { db } = await import(\"@/lib/firebase\");\r\n\r\n      const q = query(\r\n        collection(db, \"requests\"),\r\n        where(\"clientId\", \"==\", user.uid),\r\n        where(\"paymentId\", \"!=\", null),\r\n        orderBy(\"paymentId\"),\r\n        orderBy(\"createdAt\", \"desc\"),\r\n      );\r\n\r\n      const querySnapshot = await getDocs(q);\r\n      const docs = querySnapshot.docs.map((doc) => ({\r\n        id: doc.id,\r\n        ...doc.data(),\r\n      }));\r\n      setTransactions(docs);\r\n    } catch (error) {\r\n      console.error(\"Error fetching transactions:\", error);\r\n    } finally {\r\n      setLoadingTransactions(false);\r\n    }\r\n  };\r\n\r\n  const handleSave = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!user) return;\r\n    setLoading(true);\r\n\r\n    try {\r\n      await updateProfile(user, {\r\n        displayName: name,\r\n      });\r\n\r\n      // Save professional info to Firestore if role is rep\r\n      if (userData?.role === \"rep\") {\r\n        const { doc, updateDoc } = await import(\"firebase/firestore\");\r\n        const { db } = await import(\"@/lib/firebase\");\r\n        await updateDoc(doc(db, \"users\", user.uid), {\r\n          profession,\r\n          specialization,\r\n          address,\r\n          schedule,\r\n          financialInfo: {\r\n            cbu,\r\n            alias,\r\n            bankName,\r\n            accountHolder,\r\n          },\r\n          lastUpdated: new Date(),\r\n        });\r\n      }\r\n\r\n      alert(\"Perfil actualizado correctamente\");\r\n    } catch (error) {\r\n      console.error(\"Error updating profile:\", error);\r\n      alert(\"Error al actualizar perfil\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file || !user) return;\r\n\r\n    try {\r\n      const storageRef = ref(storage, `profile_pictures/${user.uid}`);\r\n      await uploadBytes(storageRef, file);\r\n      const url = await getDownloadURL(storageRef);\r\n\r\n      await updateProfile(user, { photoURL: url });\r\n      alert(\r\n        \"Foto de perfil actualizada. Recarga la p??gina para ver los cambios.\",\r\n      );\r\n    } catch (error) {\r\n      console.error(\"Error uploading profile pic:\", error);\r\n      alert(\"Error al subir la imagen\");\r\n    }\r\n  };\r\n\r\n  const dashboardPath =\r\n    userData?.role === \"admin\"\r\n      ? \"/admin\"\r\n      : userData?.role === \"rep\"\r\n        ? \"/dashboard/rep\"\r\n        : \"/dashboard/client\";\r\n\r\n  const menuItems = [\r\n    { id: \"perfil\", label: \"Mi Perfil\", icon: \"person\" },\r\n    { id: \"seguridad\", label: \"Seguridad\", icon: \"lock\" },\r\n    { id: \"pagos\", label: \"M??todos de Pago\", icon: \"payment\" },\r\n    { id: \"notificaciones\", label: \"Notificaciones\", icon: \"notifications\" },\r\n    ...(userData?.role === \"rep\"\r\n      ? [\r\n          { id: \"info_profesional\", label: \"Info Profesional\", icon: \"work\" },\r\n          {\r\n            id: \"verificacion\",\r\n            label: \"Verificaci??n\",\r\n            icon: \"verified_user\",\r\n          },\r\n        ]\r\n      : []),\r\n  ];\r\n\r\n  return (\r\n    <div className=\"bg-background-light dark:bg-background-dark min-h-screen font-sans text-slate-800 dark:text-slate-200\">\r\n      {/* Navbar Content */}\r\n      <nav className=\"bg-white dark:bg-[#1a2632] border-b border-slate-200 dark:border-slate-700 h-16 flex items-center justify-between px-4 lg:px-8\">\r\n        <Link\r\n          href={dashboardPath}\r\n          className=\"flex items-center gap-3 text-slate-600 dark:text-slate-300 hover:text-primary transition-colors\"\r\n        >\r\n          <span className=\"material-symbols-outlined\">arrow_back</span>\r\n          <span className=\"font-semibold hidden sm:inline\">\r\n            Volver al Dashboard\r\n          </span>\r\n        </Link>\r\n        <div className=\"font-bold text-lg\">Configuraci??n</div>\r\n        <div className=\"w-8\"></div>\r\n      </nav>\r\n\r\n      <main className=\"max-w-7xl mx-auto p-4 lg:p-8\">\r\n        <div className=\"grid lg:grid-cols-[280px_1fr] gap-6\">\r\n          {/* Sidebar Navigation */}\r\n          <aside className=\"lg:sticky lg:top-24 lg:self-start\">\r\n            <div className=\"bg-white dark:bg-[#1a2632] rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-4 space-y-2\">\r\n              {menuItems.map((item) => (\r\n                <button\r\n                  key={item.id}\r\n                  onClick={() => setActiveTab(item.id)}\r\n                  className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left transition-all ${\r\n                    activeTab === item.id\r\n                      ? \"bg-primary text-white shadow-md\"\r\n                      : \"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800\"\r\n                  }`}\r\n                >\r\n                  <span className=\"material-symbols-outlined text-xl\">\r\n                    {item.icon}\r\n                  </span>\r\n                  <span className=\"font-medium text-sm\">{item.label}</span>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </aside>\r\n\r\n          {/* Main Content Area */}\r\n          <div className=\"bg-white dark:bg-[#1a2632] rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 lg:p-8\">\r\n            {activeTab === \"perfil\" && (\r\n              <div className=\"space-y-8 animate-fade-in\">\r\n                <div className=\"flex flex-col sm:flex-row items-center gap-6 pb-8 border-b border-slate-100 dark:border-slate-800\">\r\n                  <div className=\"relative group cursor-pointer\">\r\n                    <img\r\n                      src={\r\n                        user?.photoURL ||\r\n                        \"https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png\"\r\n                      }\r\n                      className=\"w-24 h-24 rounded-full object-cover border-4 border-slate-50 dark:border-slate-700 group-hover:opacity-75 transition-opacity\"\r\n                      alt=\"Profile\"\r\n                      onClick={() => fileInputRef.current?.click()}\r\n                    />\r\n                    <button\r\n                      onClick={() => fileInputRef.current?.click()}\r\n                      className=\"absolute bottom-0 right-0 p-2 bg-primary text-white rounded-full hover:bg-primary-dark transition-colors shadow-lg\"\r\n                    >\r\n                      <span className=\"material-symbols-outlined text-sm\">\r\n                        edit\r\n                      </span>\r\n                    </button>\r\n                    <input\r\n                      type=\"file\"\r\n                      ref={fileInputRef}\r\n                      hidden\r\n                      accept=\"image/*\"\r\n                      onChange={handleImageUpload}\r\n                    />\r\n                  </div>\r\n                  <div className=\"text-center sm:text-left\">\r\n                    <h2 className=\"text-2xl font-bold text-slate-900 dark:text-white\">\r\n                      {user?.displayName || \"Usuario\"}\r\n                    </h2>\r\n                    <p className=\"text-slate-500 dark:text-slate-400\">\r\n                      {user?.email}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Role Switcher - ONLY for admins */}\r\n                {userData?.role === \"admin\" &&\r\n                  (() => {\r\n                    // Extract to a plain string to prevent TypeScript narrowing from\r\n                    // treating role as literally \"admin\" inside this block, which would\r\n                    // cause \"unreachable comparison\" errors with \"rep\" / \"client\".\r\n                    const currentRole: string = userData.role;\r\n                    return (\r\n                      <div className=\"bg-slate-50 dark:bg-slate-900/50 p-6 rounded-xl border border-dashed border-slate-300 dark:border-slate-700 mb-8 animate-fade-in\">\r\n                        <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4\">\r\n                          <div>\r\n                            <h3 className=\"font-bold text-slate-900 dark:text-white mb-1 flex items-center gap-2\">\r\n                              <span className=\"material-symbols-outlined text-primary\">\r\n                                manage_accounts\r\n                              </span>\r\n                              Tipo de Cuenta\r\n                            </h3>\r\n                            <p className=\"text-sm text-slate-600 dark:text-slate-400\">\r\n                              Tu rol actual es:{\" \"}\r\n                              <strong className=\"uppercase\">\r\n                                {currentRole === \"rep\"\r\n                                  ? \"Representante\"\r\n                                  : currentRole === \"admin\"\r\n                                    ? \"Administrador\"\r\n                                    : \"Cliente\"}\r\n                              </strong>\r\n                            </p>\r\n                          </div>\r\n                          <button\r\n                            type=\"button\"\r\n                            onClick={async () => {\r\n                              if (!user) return;\r\n                              const roleForSwitch =\r\n                                currentRole === \"rep\" ? \"rep\" : \"client\";\r\n                              const newRole =\r\n                                roleForSwitch === \"rep\" ? \"client\" : \"rep\";\r\n\r\n                              if (\r\n                                !confirm(\r\n                                  `??Est??s seguro de cambiar tu cuenta a modo ${newRole === \"rep\" ? \"REPRESENTANTE\" : \"CLIENTE\"}?`,\r\n                                )\r\n                              )\r\n                                return;\r\n\r\n                              setLoading(true);\r\n                              try {\r\n                                const { doc, updateDoc } =\r\n                                  await import(\"firebase/firestore\");\r\n                                const { db } = await import(\"@/lib/firebase\");\r\n                                await updateDoc(doc(db, \"users\", user.uid), {\r\n                                  role: newRole,\r\n                                });\r\n                                alert(\r\n                                  `Tu cuenta ha sido actualizada a modo ${newRole === \"rep\" ? \"REPRESENTANTE\" : \"CLIENTE\"}. Recargando...`,\r\n                                );\r\n                                window.location.reload();\r\n                              } catch (err) {\r\n                                console.error(err);\r\n                                alert(\"Error al actualizar el rol.\");\r\n                              } finally {\r\n                                setLoading(false);\r\n                              }\r\n                            }}\r\n                            className={`px-4 py-2 rounded-lg font-bold text-sm transition-colors shadow-sm ${\r\n                              currentRole === \"rep\"\r\n                                ? \"bg-blue-100 text-blue-700 hover:bg-blue-200\"\r\n                                : \"bg-green-100 text-green-700 hover:bg-green-200\"\r\n                            }`}\r\n                          >\r\n                            Cambiar a{\" \"}\r\n                            {currentRole === \"rep\"\r\n                              ? \"Cliente\"\r\n                              : \"Representante\"}\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })()}\r\n\r\n                <form\r\n                  onSubmit={handleSave}\r\n                  className=\"grid grid-cols-1 md:grid-cols-2 gap-6\"\r\n                >\r\n                  <div className=\"space-y-2 md:col-span-2\">\r\n                    <label className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                      Nombre Completo\r\n                    </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={name}\r\n                      onChange={(e) => setName(e.target.value)}\r\n                      className=\"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-primary focus:border-primary px-4 py-2\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                      Email\r\n                    </label>\r\n                    <input\r\n                      type=\"email\"\r\n                      disabled\r\n                      value={user?.email || \"\"}\r\n                      className=\"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-slate-100 dark:bg-slate-900 text-slate-500 dark:text-slate-400 cursor-not-allowed px-4 py-2\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                      ID de Usuario\r\n                    </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      disabled\r\n                      value={user?.uid || \"\"}\r\n                      className=\"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-slate-100 dark:bg-slate-900 text-slate-500 dark:text-slate-400 cursor-not-allowed px-4 py-2 font-mono text-xs\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"md:col-span-2 pt-4\">\r\n                    <button\r\n                      type=\"submit\"\r\n                      disabled={loading}\r\n                      className=\"bg-primary text-white px-6 py-2.5 rounded-lg font-bold hover:bg-primary-dark transition-colors shadow-lg shadow-blue-500/20 disabled:opacity-50\"\r\n                    >\r\n                      {loading ? \"Guardando...\" : \"Guardar Cambios\"}\r\n                    </button>\r\n                  </div>\r\n                </form>\r\n              </div>\r\n            )}\r\n\r\n            {activeTab === \"seguridad\" && (\r\n              <div className=\"space-y-8 animate-fade-in\">\r\n                <div className=\"space-y-4\">\r\n                  <h3 className=\"text-lg font-bold text-slate-900 dark:text-white\">\r\n                    Cambiar Contrase??a\r\n                  </h3>\r\n                  <div className=\"space-y-4 max-w-md\">\r\n                    <input\r\n                      type=\"password\"\r\n                      placeholder=\"Contrase??a actual\"\r\n                      className=\"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 px-4 py-2\"\r\n                    />\r\n                    <input\r\n                      type=\"password\"\r\n                      placeholder=\"Nueva contrase??a\"\r\n                      className=\"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 px-4 py-2\"\r\n                    />\r\n                    <input\r\n                      type=\"password\"\r\n                      placeholder=\"Confirmar nueva contrase??a\"\r\n                      className=\"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 px-4 py-2\"\r\n                    />\r\n                    <button className=\"bg-slate-900 text-white px-4 py-2 rounded-lg font-medium hover:bg-slate-800 transition-colors\">\r\n                      Actualizar Contrase??a\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n                <div className=\"border-t border-slate-100 dark:border-slate-800 pt-8\">\r\n                  <h3 className=\"text-lg font-bold text-slate-900 dark:text-white mb-4\">\r\n                    Autenticaci??n de dos pasos (2FA)\r\n                  </h3>\r\n                  <div className=\"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                      <div className=\"w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center\">\r\n                        <span className=\"material-symbols-outlined\">\r\n                          security\r\n                        </span>\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"font-medium text-slate-900 dark:text-white\">\r\n                          Autenticaci??n por SMS\r\n                        </p>\r\n                        <p className=\"text-xs text-slate-500\">\r\n                          Recibe un c??digo en tu tel??fono al iniciar sesi??n.\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        value=\"\"\r\n                        className=\"sr-only peer\"\r\n                      />\r\n                      <div className=\"w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-slate-600 peer-checked:bg-primary\"></div>\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {activeTab === \"pagos\" && (\r\n              <div className=\"space-y-8 animate-fade-in\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <h3 className=\"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2\">\r\n                    <span className=\"material-symbols-outlined text-primary\">\r\n                      payments\r\n                    </span>\r\n                    M??todos de Pago\r\n                  </h3>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <span className=\"text-[#009EE3] font-black text-xl tracking-tight\">\r\n                      Mercado\r\n                    </span>\r\n                    <span className=\"bg-[#009EE3] text-white font-black text-xl px-1.5 rounded tracking-tight\">\r\n                      Pago\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-2xl p-6\">\r\n                  <div className=\"flex gap-4 items-start\">\r\n                    <div className=\"bg-blue-500 text-white p-2 rounded-lg\">\r\n                      <span className=\"material-symbols-outlined\">\r\n                        security\r\n                      </span>\r\n                    </div>\r\n                    <div>\r\n                      <h4 className=\"font-bold text-blue-900 dark:text-blue-300\">\r\n                        Pagos Seguros y Protegidos\r\n                      </h4>\r\n                      <p className=\"text-sm text-blue-700 dark:text-blue-400 mt-1\">\r\n                        Utilizamos Mercado Pago para procesar todas las\r\n                        transacciones. Tu informaci??n financiera est?? protegida\r\n                        y nunca se almacena en nuestros servidores.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <h4 className=\"font-bold text-slate-900 dark:text-white\">\r\n                      Transacciones Recientes\r\n                    </h4>\r\n                    <button\r\n                      onClick={fetchTransactions}\r\n                      className=\"text-primary text-xs font-bold hover:underline flex items-center gap-1\"\r\n                    >\r\n                      <span className=\"material-symbols-outlined text-xs\">\r\n                        refresh\r\n                      </span>\r\n                      Actualizar\r\n                    </button>\r\n                  </div>\r\n\r\n                  {loadingTransactions ? (\r\n                    <div className=\"flex flex-col items-center py-10 gap-3\">\r\n                      <div className=\"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin\"></div>\r\n                      <p className=\"text-sm text-slate-500\">\r\n                        Cargando historial de pagos...\r\n                      </p>\r\n                    </div>\r\n                  ) : transactions.length > 0 ? (\r\n                    <div className=\"space-y-3\">\r\n                      {transactions.map((tx) => (\r\n                        <div\r\n                          key={tx.id}\r\n                          className=\"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700\"\r\n                        >\r\n                          <div className=\"flex items-center gap-4\">\r\n                            <div className=\"w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center\">\r\n                              <span className=\"material-symbols-outlined\">\r\n                                shopping_cart\r\n                              </span>\r\n                            </div>\r\n                            <div>\r\n                              <p className=\"font-bold text-sm text-slate-900 dark:text-white\">\r\n                                {tx.title}\r\n                              </p>\r\n                              <p className=\"text-xs text-slate-500\">\r\n                                {tx.paidAt?.toDate\r\n                                  ? tx.paidAt.toDate().toLocaleDateString()\r\n                                  : \"Reciente\"}\r\n                              </p>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"text-right\">\r\n                            <p className=\"font-bold text-slate-900 dark:text-white\">\r\n                              ${tx.paymentAmount || tx.budget}\r\n                            </p>\r\n                            <span className=\"text-[10px] px-2 py-0.5 bg-green-100 text-green-700 rounded-full font-bold\">\r\n                              {tx.paymentStatus === \"approved\"\r\n                                ? \"Aprobado\"\r\n                                : tx.paymentStatus || \"Pagado\"}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"text-center py-12 bg-slate-50 dark:bg-slate-800/50 rounded-2xl border-2 border-dashed border-slate-200 dark:border-slate-700\">\r\n                      <span className=\"material-symbols-outlined text-4xl text-slate-300 mb-3 block\">\r\n                        receipt_long\r\n                      </span>\r\n                      <p className=\"text-slate-500 dark:text-slate-400 font-medium\">\r\n                        No tienes transacciones registradas a??n.\r\n                      </p>\r\n                      <Link\r\n                        href=\"/dashboard/client\"\r\n                        className=\"text-primary text-sm font-bold mt-2 inline-block hover:underline\"\r\n                      >\r\n                        Ir al dashboard para contratar servicios\r\n                      </Link>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"pt-4 border-t border-slate-100 dark:border-slate-800\">\r\n                  <h4 className=\"font-bold text-slate-900 dark:text-white mb-2 text-sm\">\r\n                    Gesti??n de Tarjetas\r\n                  </h4>\r\n                  <p className=\"text-xs text-slate-500 dark:text-slate-400\">\r\n                    Mercado Pago recuerda tus tarjetas guardadas de forma\r\n                    autom??tica cuando usas el mismo email. Puedes gestionarlas\r\n                    directamente desde tu cuenta de Mercado Pago.\r\n                  </p>\r\n                </div>\r\n\r\n                {userData?.role === \"rep\" && (\r\n                  <div className=\"pt-4 border-t border-slate-100 dark:border-slate-800 animate-fade-in\">\r\n                    <h4 className=\"font-bold text-slate-900 dark:text-white mb-4 text-lg\">\r\n                      Datos Bancarios (Para Cobros)\r\n                    </h4>\r\n                    <p className=\"text-sm text-slate-500 dark:text-slate-400 mb-6\">\r\n                      Ingresa tu CBU o Alias para recibir los pagos de tus\r\n                      servicios completados.\r\n                    </p>\r\n\r\n                    <form\r\n                      onSubmit={handleSave}\r\n                      className=\"grid grid-cols-1 md:grid-cols-2 gap-6 bg-slate-50 dark:bg-slate-900/50 p-6 rounded-2xl border border-slate-200 dark:border-slate-800\"\r\n                    >\r\n                      <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                          CBU / CVU\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          value={cbu}\r\n                          onChange={(e) => setCbu(e.target.value)}\r\n                          placeholder=\"0000000000000000000000\"\r\n                          className=\"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-primary focus:border-primary px-4 py-2\"\r\n                        />\r\n                      </div>\r\n                      <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                          Alias\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          value={alias}\r\n                          onChange={(e) => setAlias(e.target.value)}\r\n                          placeholder=\"mi.alias.banco\"\r\n                          className=\"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-primary focus:border-primary px-4 py-2\"\r\n                        />\r\n                      </div>\r\n                      <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                          Banco / Billetera\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          value={bankName}\r\n                          onChange={(e) => setBankName(e.target.value)}\r\n                          placeholder=\"Ej. Banco Galicia, Mercado Pago...\"\r\n                          className=\"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-primary focus:border-primary px-4 py-2\"\r\n                        />\r\n                      </div>\r\n                      <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                          Titular de la Cuenta\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          value={accountHolder}\r\n                          onChange={(e) => setAccountHolder(e.target.value)}\r\n                          placeholder=\"Nombre completo del titular\"\r\n                          className=\"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-primary focus:border-primary px-4 py-2\"\r\n                        />\r\n                      </div>\r\n                      <div className=\"md:col-span-2 pt-2\">\r\n                        <button\r\n                          type=\"submit\"\r\n                          disabled={loading}\r\n                          className=\"w-full md:w-auto bg-primary text-white px-6 py-2.5 rounded-lg font-bold hover:bg-primary-dark transition-colors shadow-lg shadow-blue-500/20 disabled:opacity-50\"\r\n                        >\r\n                          {loading ? \"Guardando...\" : \"Guardar Datos Bancarios\"}\r\n                        </button>\r\n                      </div>\r\n                    </form>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {activeTab === \"notificaciones\" && (\r\n              <div className=\"space-y-8 animate-fade-in\">\r\n                <div className=\"space-y-4\">\r\n                  <h3 className=\"text-lg font-bold text-slate-900 dark:text-white\">\r\n                    Preferencias de Notificaci??n\r\n                  </h3>\r\n                  <div className=\"space-y-4\">\r\n                    {[\r\n                      {\r\n                        id: \"new_tasks\",\r\n                        label: \"Nuevas tareas disponibles\",\r\n                        desc: \"Te avisaremos cuando haya tareas cerca de tu ubicaci??n.\",\r\n                      },\r\n                      {\r\n                        id: \"chat\",\r\n                        label: \"Mensajes de chat\",\r\n                        desc: \"Recibe una notificaci??n cuando un cliente te escriba.\",\r\n                      },\r\n                      {\r\n                        id: \"status\",\r\n                        label: \"Cambios de estado\",\r\n                        desc: \"Alertas cuando una tarea cambie de estado.\",\r\n                      },\r\n                    ].map((item) => (\r\n                      <div\r\n                        key={item.id}\r\n                        className=\"flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700\"\r\n                      >\r\n                        <div>\r\n                          <p className=\"font-medium text-slate-900 dark:text-white\">\r\n                            {item.label}\r\n                          </p>\r\n                          <p className=\"text-xs text-slate-500\">{item.desc}</p>\r\n                        </div>\r\n                        <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                          <input\r\n                            type=\"checkbox\"\r\n                            defaultChecked\r\n                            className=\"sr-only peer\"\r\n                          />\r\n                          <div className=\"w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-slate-600 peer-checked:bg-primary\"></div>\r\n                        </label>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {activeTab === \"verificacion\" && userData?.role === \"rep\" && (\r\n              <div className=\"space-y-8 animate-fade-in\">\r\n                <div className=\"bg-slate-50 dark:bg-slate-900/50 p-6 rounded-2xl border border-dashed border-slate-200 dark:border-slate-800 text-center\">\r\n                  <div className=\"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 text-primary rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                    <span className=\"material-symbols-outlined text-3xl\">\r\n                      badge\r\n                    </span>\r\n                  </div>\r\n                  <h3 className=\"text-xl font-bold text-slate-900 dark:text-white mb-2\">\r\n                    Verificaci??n de Identidad\r\n                  </h3>\r\n                  <p className=\"text-slate-500 dark:text-slate-400 max-w-md mx-auto mb-6\">\r\n                    Para poder tomar tareas y recibir pagos, necesitamos\r\n                    verificar tu identidad. Sube una foto de tu DNI o Pasaporte\r\n                    (frente y dorso).\r\n                  </p>\r\n\r\n                  <div className=\"flex flex-col items-center gap-4\">\r\n                    <div className=\"flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700\">\r\n                      <span className=\"text-sm font-medium\">Estado:</span>\r\n                      <span\r\n                        className={`text-sm font-bold px-2 py-0.5 rounded-full ${\r\n                          userData?.verificationStatus === \"verified\"\r\n                            ? \"bg-green-100 text-green-700\"\r\n                            : userData?.verificationStatus === \"pending\"\r\n                              ? \"bg-yellow-100 text-yellow-700\"\r\n                              : userData?.verificationStatus === \"rejected\"\r\n                                ? \"bg-red-100 text-red-700\"\r\n                                : \"bg-slate-100 text-slate-700\"\r\n                        }`}\r\n                      >\r\n                        {userData?.verificationStatus === \"verified\"\r\n                          ? \"Verificado\"\r\n                          : userData?.verificationStatus === \"pending\"\r\n                            ? \"Pendiente de Revisi??n\"\r\n                            : userData?.verificationStatus === \"rejected\"\r\n                              ? \"Rechazado\"\r\n                              : \"No Verificado\"}\r\n                      </span>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4 w-full mt-4\">\r\n                      {[\r\n                        { id: \"front\", label: \"DNI (Frente)\", icon: \"badge\" },\r\n                        { id: \"back\", label: \"DNI (Dorso)\", icon: \"badge\" },\r\n                        { id: \"selfie\", label: \"Selfie con DNI\", icon: \"face\" },\r\n                      ].map((docType) => {\r\n                        const isUploaded = !!userData?.[`doc_${docType.id}`];\r\n                        return (\r\n                          <button\r\n                            key={docType.id}\r\n                            onClick={() => {\r\n                              const input = document.createElement(\"input\");\r\n                              input.type = \"file\";\r\n                              input.accept = \"image/*\";\r\n                              input.onchange = async (e: any) => {\r\n                                const file = e.target.files[0];\r\n                                if (!file) return;\r\n                                setLoading(true);\r\n                                try {\r\n                                  const { doc, updateDoc } =\r\n                                    await import(\"firebase/firestore\");\r\n                                  const { db } = await import(\"@/lib/firebase\");\r\n                                  const storageRef = ref(\r\n                                    storage,\r\n                                    `verifications/${user?.uid}/${docType.id}`,\r\n                                  );\r\n                                  await uploadBytes(storageRef, file);\r\n                                  const url = await getDownloadURL(storageRef);\r\n\r\n                                  await updateDoc(doc(db, \"users\", user!.uid), {\r\n                                    [`doc_${docType.id}`]: url,\r\n                                    verificationStatus: \"pending\",\r\n                                    verificationSubmittedAt: new Date(),\r\n                                  });\r\n                                  alert(\r\n                                    `${docType.label} subida correctamente.`,\r\n                                  );\r\n                                } catch (err) {\r\n                                  console.error(err);\r\n                                  alert(\"Error al subir el documento\");\r\n                                } finally {\r\n                                  setLoading(false);\r\n                                }\r\n                              };\r\n                              input.click();\r\n                            }}\r\n                            disabled={\r\n                              loading ||\r\n                              userData?.verificationStatus === \"verified\"\r\n                            }\r\n                            className={`flex flex-col items-center p-4 rounded-xl border-2 border-dashed transition-all ${\r\n                              isUploaded\r\n                                ? \"border-green-500 bg-green-50 dark:bg-green-900/10\"\r\n                                : \"border-slate-200 dark:border-slate-700 hover:border-primary bg-white dark:bg-slate-800\"\r\n                            }`}\r\n                          >\r\n                            <span\r\n                              className={`material-symbols-outlined text-2xl mb-2 ${isUploaded ? \"text-green-500\" : \"text-slate-400\"}`}\r\n                            >\r\n                              {isUploaded ? \"check_circle\" : docType.icon}\r\n                            </span>\r\n                            <span className=\"text-xs font-bold\">\r\n                              {docType.label}\r\n                            </span>\r\n                            {isUploaded && (\r\n                              <span className=\"text-[10px] text-green-600 font-medium\">\r\n                                Subido\r\n                              </span>\r\n                            )}\r\n                          </button>\r\n                        );\r\n                      })}\r\n                    </div>\r\n\r\n                    {userData?.verificationStatus === \"pending\" && (\r\n                      <p className=\"text-xs text-slate-400 italic\">\r\n                        Tu documento est?? siendo procesado por nuestro equipo de\r\n                        seguridad.\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                  <div className=\"p-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700\">\r\n                    <span className=\"material-symbols-outlined text-primary mb-2\">\r\n                      lock\r\n                    </span>\r\n                    <h4 className=\"font-bold text-sm mb-1\">Privacidad</h4>\r\n                    <p className=\"text-xs text-slate-500\">\r\n                      Tus datos est??n encriptados y protegidos.\r\n                    </p>\r\n                  </div>\r\n                  <div className=\"p-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700\">\r\n                    <span className=\"material-symbols-outlined text-primary mb-2\">\r\n                      speed\r\n                    </span>\r\n                    <h4 className=\"font-bold text-sm mb-1\">Rapidez</h4>\r\n                    <p className=\"text-xs text-slate-500\">\r\n                      Revisamos los documentos en menos de 24hs.\r\n                    </p>\r\n                  </div>\r\n                  <div className=\"p-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700\">\r\n                    <span className=\"material-symbols-outlined text-primary mb-2\">\r\n                      verified_user\r\n                    </span>\r\n                    <h4 className=\"font-bold text-sm mb-1\">Confianza</h4>\r\n                    <p className=\"text-xs text-slate-500\">\r\n                      Un perfil verificado atrae 3x m??s clientes.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n            {activeTab === \"info_profesional\" && userData?.role === \"rep\" && (\r\n              <div className=\"space-y-8 animate-fade-in\">\r\n                <div className=\"flex items-center gap-4 mb-6\">\r\n                  <div className=\"w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 text-primary flex items-center justify-center\">\r\n                    <span className=\"material-symbols-outlined text-2xl\">\r\n                      work\r\n                    </span>\r\n                  </div>\r\n                  <div>\r\n                    <h2 className=\"text-xl font-bold text-slate-900 dark:text-white\">\r\n                      Perfil Profesional\r\n                    </h2>\r\n                    <p className=\"text-sm text-slate-500 dark:text-slate-400\">\r\n                      Completa tu informaci??n para recibir mejores propuestas.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                <form\r\n                  onSubmit={handleSave}\r\n                  className=\"grid grid-cols-1 md:grid-cols-2 gap-6\"\r\n                >\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                      Profesi??n / T??tulo Principal\r\n                    </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={profession}\r\n                      onChange={(e) => setProfession(e.target.value)}\r\n                      placeholder=\"Ej. Mec??nico, Gestor, Abogado...\"\r\n                      className=\"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-primary focus:border-primary px-4 py-2\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                      Especializaci??n\r\n                    </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={specialization}\r\n                      onChange={(e) => setSpecialization(e.target.value)}\r\n                      placeholder=\"Ej. Motores Diesel, Divorcios...\"\r\n                      className=\"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-primary focus:border-primary px-4 py-2\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2 md:col-span-2\">\r\n                    <label className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                      Zona de Cobertura / Ubicaci??n\r\n                    </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={address}\r\n                      onChange={(e) => setAddress(e.target.value)}\r\n                      placeholder=\"Ej. Palermo, CABA (y alrededores de 5km)\"\r\n                      className=\"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-primary focus:border-primary px-4 py-2\"\r\n                    />\r\n                    <p className=\"text-xs text-slate-500\">\r\n                      Esto ayudar?? a mostrarte tareas cercanas.\r\n                    </p>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2 md:col-span-2\">\r\n                    <label className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                      Disponibilidad Horaria\r\n                    </label>\r\n                    <textarea\r\n                      value={schedule}\r\n                      onChange={(e) => setSchedule(e.target.value)}\r\n                      rows={3}\r\n                      placeholder=\"Ej. Lunes a Viernes de 9 a 18hs. S??bados solo urgencias.\"\r\n                      className=\"w-full rounded-lg border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-primary focus:border-primary px-4 py-2 resize-none\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"md:col-span-2 pt-4\">\r\n                    <button\r\n                      type=\"submit\"\r\n                      disabled={loading}\r\n                      className=\"bg-primary text-white px-6 py-2.5 rounded-lg font-bold hover:bg-primary-dark transition-colors shadow-lg shadow-blue-500/20 disabled:opacity-50 w-full md:w-auto\"\r\n                    >\r\n                      {loading\r\n                        ? \"Guardando...\"\r\n                        : \"Guardar Informaci??n Profesional\"}\r\n                    </button>\r\n                  </div>\r\n                </form>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </main>\r\n      <style jsx>{`\r\n        .animate-fade-in {\r\n          animation: fadeIn 0.3s ease-in-out;\r\n        }\r\n        @keyframes fadeIn {\r\n          from {\r\n            opacity: 0;\r\n            transform: translateY(5px);\r\n          }\r\n          to {\r\n            opacity: 1;\r\n            transform: translateY(0);\r\n          }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]}]
